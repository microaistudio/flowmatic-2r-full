<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FlowMatic Admin Panel</title>
    <style>
        /* FlowMatic Design System - Professional Light Theme */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Inter, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background-color: #F8F9FA;
            color: #1F2937;
            min-height: 100vh;
        }

        /* LOGIN SCREEN */
        .login-container {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #F8F9FA 0%, #FFFFFF 100%);
        }

        .login-card {
            background: #FFFFFF;
            padding: 48px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            width: 100%;
            max-width: 400px;
            text-align: center;
        }

        .login-header {
            margin-bottom: 32px;
        }

        .login-header h1 {
            font-size: 24px;
            font-weight: 600;
            color: #1F2937;
            margin-bottom: 8px;
        }

        .login-header p {
            font-size: 14px;
            color: #6B7280;
        }

        .form-group {
            margin-bottom: 24px;
            text-align: left;
        }

        .form-group label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            color: #374151;
            margin-bottom: 8px;
        }

        .form-group input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid #E5E7EB;
            border-radius: 8px;
            font-size: 14px;
            background: #FFFFFF;
            color: #1F2937;
            transition: border-color 0.2s;
        }

        .form-group input:focus {
            outline: none;
            border-color: #10B981;
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }

        .login-button {
            width: 100%;
            padding: 12px 24px;
            background: #10B981;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .login-button:hover {
            background: #059669;
        }

        .login-button:disabled {
            background: #9CA3AF;
            cursor: not-allowed;
        }

        .error-message {
            background: #FEF2F2;
            color: #EF4444;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 14px;
            margin-bottom: 16px;
            border: 1px solid #FECACA;
        }

        /* MAIN ADMIN LAYOUT */
        .admin-layout {
            display: none; /* Hidden until login */
            min-height: 100vh;
            background: #F8F9FA;
        }

        .admin-header {
            background: #FFFFFF;
            border-bottom: 1px solid #E5E7EB;
            padding: 0 32px;
            height: 64px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .admin-header h1 {
            font-size: 18px;
            font-weight: 600;
            color: #1F2937;
        }

        .admin-header-right {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .admin-user {
            font-size: 14px;
            color: #6B7280;
        }

        .logout-button {
            padding: 8px 16px;
            background: transparent;
            color: #6B7280;
            border: 1px solid #E5E7EB;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .logout-button:hover {
            background: #F3F4F6;
            color: #374151;
        }

        .admin-content {
            display: flex;
            min-height: calc(100vh - 64px);
        }

        /* SIDEBAR NAVIGATION */
        .admin-sidebar {
            width: 256px;
            background: #F8F9FA;
            border-right: 1px solid #E5E7EB;
            padding: 24px 0;
        }

        .nav-item {
            display: flex;
            align-items: center;
            padding: 12px 24px;
            color: #6B7280;
            text-decoration: none;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
            cursor: pointer;
        }

        .nav-item:hover {
            background: #FFFFFF;
            color: #374151;
        }

        .nav-item.active {
            background: #FFFFFF;
            color: #10B981;
            border-right: 3px solid #10B981;
        }

        .nav-item-icon {
            width: 20px;
            height: 20px;
            margin-right: 12px;
            font-size: 16px;
        }

        /* MAIN CONTENT AREA */
        .admin-main {
            flex: 1;
            background: #FFFFFF;
            padding: 32px;
            overflow-y: auto;
        }

        .admin-section {
            display: none;
        }

        .admin-section.active {
            display: block;
        }

        .section-header {
            margin-bottom: 32px;
        }

        .section-title {
            font-size: 24px;
            font-weight: 600;
            color: #1F2937;
            margin-bottom: 8px;
        }

        .section-description {
            font-size: 14px;
            color: #6B7280;
        }

        /* CARD COMPONENTS */
        .card {
            background: #FFFFFF;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            padding: 24px;
            margin-bottom: 24px;
        }

        .card-header {
            display: flex;
            align-items: center;
            justify-content: between;
            margin-bottom: 16px;
        }

        .card-title {
            font-size: 18px;
            font-weight: 600;
            color: #1F2937;
        }

        /* DASHBOARD COMPONENTS */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }

        .stat-card {
            background: #FFFFFF;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            border: 1px solid #F3F4F6;
            display: flex;
            align-items: center;
            gap: 16px;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--accent-color);
        }

        .stat-card.green { --accent-color: #10B981; }
        .stat-card.orange { --accent-color: #F59E0B; }
        .stat-card.purple { --accent-color: #8B5CF6; }
        .stat-card.blue { --accent-color: #3B82F6; }

        .stat-icon {
            width: 48px;
            height: 48px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: white;
            flex-shrink: 0;
        }

        .stat-icon.green { background: #10B981; }
        .stat-icon.orange { background: #F59E0B; }
        .stat-icon.purple { background: #8B5CF6; }
        .stat-icon.blue { background: #3B82F6; }

        .stat-content {
            flex: 1;
        }

        .stat-value {
            font-size: 28px;
            font-weight: 700;
            color: #1F2937;
            line-height: 1;
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 14px;
            color: #6B7280;
            font-weight: 500;
        }

        .stat-trend {
            font-size: 12px;
            color: #059669;
            font-weight: 500;
            text-align: right;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 24px;
            margin-bottom: 32px;
        }

        .activity-card {
            min-height: 400px;
        }

        .queue-status-card {
            min-height: 400px;
        }

        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 1px solid #F3F4F6;
        }

        .refresh-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #10B981;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .refresh-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            padding: 4px;
            border-radius: 4px;
            transition: background-color 0.2s;
        }

        .refresh-btn:hover {
            background: #F3F4F6;
        }

        .activity-feed {
            max-height: 320px;
            overflow-y: auto;
        }

        .activity-item {
            display: flex;
            gap: 12px;
            padding: 12px 0;
            border-bottom: 1px solid #F9FAFB;
            font-size: 14px;
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-time {
            color: #6B7280;
            font-weight: 500;
            min-width: 50px;
        }

        .activity-text {
            color: #374151;
            flex: 1;
        }

        .activity-item.loading {
            color: #9CA3AF;
            font-style: italic;
        }

        .queue-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .queue-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px;
            background: #F9FAFB;
            border-radius: 8px;
            border: 1px solid #F3F4F6;
        }

        .service-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            color: white;
        }

        .service-badge.general { background: #10B981; }
        .service-badge.account { background: #F59E0B; }
        .service-badge.vip { background: #8B5CF6; }
        .service-badge.technical { background: #3B82F6; }

        .queue-count {
            font-size: 18px;
            font-weight: 600;
            color: #1F2937;
        }

        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
        }

        .action-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .action-btn.primary {
            background: #10B981;
            color: white;
        }

        .action-btn.primary:hover {
            background: #059669;
        }

        .action-btn.secondary {
            background: #F59E0B;
            color: white;
        }

        .action-btn.secondary:hover {
            background: #D97706;
        }

        .action-btn.info {
            background: #3B82F6;
            color: white;
        }

        .action-btn.info:hover {
            background: #2563EB;
        }

        .action-btn.warning {
            background: #EF4444;
            color: white;
        }

        .action-btn.warning:hover {
            background: #DC2626;
        }

        .health-indicators {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
        }

        .health-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 16px;
            background: #F9FAFB;
            border-radius: 8px;
            border: 1px solid #F3F4F6;
        }

        .health-label {
            font-size: 14px;
            font-weight: 500;
            color: #374151;
        }

        .health-status {
            font-size: 12px;
        }

        .health-status.online {
            color: #10B981;
        }

        .health-status.offline {
            color: #EF4444;
        }

        .health-value {
            font-size: 14px;
            font-weight: 600;
            color: #1F2937;
        }

        /* SERVICES MANAGEMENT STYLES */
        .services-stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }

        .service-stat-card {
            background: #FFFFFF;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            border: 1px solid #F3F4F6;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .service-stat-content {
            flex: 1;
        }

        .service-stat-value {
            font-size: 24px;
            font-weight: 700;
            color: #1F2937;
            line-height: 1;
            margin-bottom: 4px;
        }

        .service-stat-label {
            font-size: 12px;
            color: #6B7280;
            font-weight: 500;
        }

        .service-stat-icon {
            font-size: 24px;
            opacity: 0.7;
        }

        .services-header-actions {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .search-box {
            position: relative;
        }

        .search-box input {
            padding: 8px 16px;
            border: 1px solid #E5E7EB;
            border-radius: 6px;
            font-size: 14px;
            width: 200px;
            background: #FFFFFF;
        }

        .search-box input:focus {
            outline: none;
            border-color: #10B981;
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }

        .services-table-container {
            overflow-x: auto;
            border-radius: 8px;
            border: 1px solid #F3F4F6;
        }

        .services-table {
            width: 100%;
            border-collapse: collapse;
            background: #FFFFFF;
        }

        .services-table th {
            background: #F9FAFB;
            color: #374151;
            font-weight: 600;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            padding: 12px 16px;
            text-align: left;
            border-bottom: 1px solid #E5E7EB;
        }

        .services-table td {
            padding: 16px;
            border-bottom: 1px solid #F3F4F6;
            font-size: 14px;
            color: #374151;
        }

        .services-table tbody tr:hover {
            background: #F9FAFB;
        }

        .services-table tbody tr:last-child td {
            border-bottom: none;
        }

        .service-prefix {
            display: inline-block;
            padding: 4px 12px;
            background: #F3F4F6;
            border-radius: 12px;
            font-weight: 600;
            font-size: 12px;
            color: #374151;
        }

        .service-status {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .service-status.active {
            background: #D1FAE5;
            color: #065F46;
        }

        .service-status.inactive {
            background: #FEE2E2;
            color: #991B1B;
        }

        .service-actions {
            display: flex;
            gap: 8px;
        }

        .service-action-btn {
            padding: 6px 8px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
            background: transparent;
        }

        .service-action-btn:hover {
            background: #F3F4F6;
        }

        .service-action-btn.edit {
            color: #3B82F6;
        }

        .service-action-btn.delete {
            color: #EF4444;
        }

        .service-action-btn.toggle {
            color: #8B5CF6;
        }

        .loading-row td {
            text-align: center;
            color: #9CA3AF;
            font-style: italic;
            padding: 40px 16px;
        }

        .service-performance-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .performance-item {
            background: #F9FAFB;
            border-radius: 8px;
            padding: 20px;
            border: 1px solid #F3F4F6;
            text-align: center;
        }

        .performance-service-name {
            font-size: 16px;
            font-weight: 600;
            color: #1F2937;
            margin-bottom: 8px;
        }

        .performance-stats {
            display: flex;
            justify-content: space-between;
            margin-top: 12px;
            font-size: 12px;
            color: #6B7280;
        }

        .performance-loading {
            text-align: center;
            color: #9CA3AF;
            font-style: italic;
            padding: 40px;
            grid-column: 1 / -1;
        }

        /* MODAL STYLES */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            animation: fadeIn 0.2s;
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: #FFFFFF;
            border-radius: 12px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            animation: slideIn 0.3s;
        }

        .modal-content.small {
            max-width: 400px;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 24px 24px 16px;
            border-bottom: 1px solid #F3F4F6;
        }

        .modal-header h3 {
            font-size: 18px;
            font-weight: 600;
            color: #1F2937;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            color: #9CA3AF;
            cursor: pointer;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            transition: all 0.2s;
        }

        .modal-close:hover {
            background: #F3F4F6;
            color: #374151;
        }

        .modal-body {
            padding: 24px;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            padding: 16px 24px 24px;
            border-top: 1px solid #F3F4F6;
        }

        /* FORM STYLES */
        .form-group {
            margin-bottom: 20px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .form-group label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            color: #374151;
            margin-bottom: 6px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px 14px;
            border: 1px solid #E5E7EB;
            border-radius: 6px;
            font-size: 14px;
            background: #FFFFFF;
            color: #1F2937;
            transition: border-color 0.2s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #10B981;
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }

        .checkbox-label {
            display: flex !important;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            margin-bottom: 0 !important;
        }

        .checkbox-label input[type="checkbox"] {
            width: auto !important;
            margin: 0;
        }

        .checkmark {
            font-size: 14px;
            color: #374151;
        }

        .validation-messages {
            margin-top: 16px;
            padding: 12px;
            background: #FEF2F2;
            border: 1px solid #FECACA;
            border-radius: 6px;
            font-size: 14px;
            color: #DC2626;
            display: none;
        }

        .validation-messages.show {
            display: block;
        }

        .warning-text {
            color: #DC2626;
            font-size: 14px;
            margin-top: 8px;
        }

        /* COUNTERS MANAGEMENT STYLES */
        .counter-stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }

        .counter-stat-card {
            background: #FFFFFF;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            border: 1px solid #F3F4F6;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .counter-stat-content {
            flex: 1;
        }

        .counter-stat-value {
            font-size: 24px;
            font-weight: 600;
            color: #1F2937;
            margin-bottom: 4px;
        }

        .counter-stat-label {
            font-size: 14px;
            color: #6B7280;
        }

        .counter-stat-icon {
            font-size: 32px;
            opacity: 0.3;
        }

        .counter-status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 16px;
            margin-bottom: 32px;
        }

        .counter-status-card {
            background: #FFFFFF;
            border-radius: 12px;
            padding: 16px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            border: 2px solid #E5E7EB;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .counter-status-card:hover {
            border-color: #10B981;
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .counter-status-card.active {
            border-color: #10B981;
            background: #F0FDF4;
        }

        .counter-status-card.serving {
            border-color: #3B82F6;
            background: #EFF6FF;
        }

        .counter-status-card.inactive {
            border-color: #E5E7EB;
            background: #F9FAFB;
            opacity: 0.7;
        }

        .counter-status-number {
            font-size: 32px;
            font-weight: 700;
            color: #1F2937;
            margin-bottom: 8px;
        }

        .counter-status-label {
            font-size: 14px;
            font-weight: 500;
            color: #6B7280;
            margin-bottom: 4px;
        }

        .counter-status-agent {
            font-size: 13px;
            color: #374151;
            margin-bottom: 4px;
        }

        .counter-status-ticket {
            font-size: 12px;
            color: #6B7280;
        }

        .counter-status-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 500;
            margin-top: 8px;
        }

        .counter-status-badge.active {
            background: #10B981;
            color: white;
        }

        .counter-status-badge.serving {
            background: #3B82F6;
            color: white;
        }

        .counter-status-badge.inactive {
            background: #9CA3AF;
            color: white;
        }

        /* AGENTS MANAGEMENT STYLES */
        .agents-stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }

        .agent-stat-card {
            background: #FFFFFF;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            border: 1px solid #F3F4F6;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .agent-stat-content {
            flex: 1;
        }

        .agent-stat-value {
            font-size: 24px;
            font-weight: 700;
            color: #1F2937;
            line-height: 1;
            margin-bottom: 4px;
        }

        .agent-stat-label {
            font-size: 12px;
            color: #6B7280;
            font-weight: 500;
        }

        .agent-stat-icon {
            font-size: 24px;
            opacity: 0.7;
        }

        .online-count {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            color: #6B7280;
        }

        .online-indicator {
            color: #10B981;
            font-size: 12px;
            animation: pulse 2s infinite;
        }

        .online-agents-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
        }

        .online-agent-card {
            background: #F9FAFB;
            border-radius: 8px;
            padding: 16px;
            border: 1px solid #F3F4F6;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .agent-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #8B5CF6;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 16px;
        }

        .agent-info {
            flex: 1;
        }

        .agent-name {
            font-size: 14px;
            font-weight: 600;
            color: #1F2937;
            margin-bottom: 2px;
        }

        .agent-status {
            font-size: 12px;
            color: #6B7280;
        }

        .agent-services-badges {
            display: flex;
            gap: 4px;
            margin-top: 4px;
        }

        .agents-header-actions {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .agents-table-container {
            overflow-x: auto;
            border-radius: 8px;
            border: 1px solid #F3F4F6;
        }

        .agents-table {
            width: 100%;
            border-collapse: collapse;
            background: #FFFFFF;
        }

        .agents-table th {
            background: #F9FAFB;
            color: #374151;
            font-weight: 600;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            padding: 12px 16px;
            text-align: left;
            border-bottom: 1px solid #E5E7EB;
        }

        .agents-table td {
            padding: 16px;
            border-bottom: 1px solid #F3F4F6;
            font-size: 14px;
            color: #374151;
            vertical-align: middle;
        }

        .agents-table tbody tr:hover {
            background: #F9FAFB;
        }

        .agents-table tbody tr:last-child td {
            border-bottom: none;
        }

        .agent-cell {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .agent-cell .agent-avatar {
            width: 32px;
            height: 32px;
            font-size: 14px;
        }

        .agent-details {
            flex: 1;
        }

        .agent-details .agent-name {
            font-size: 14px;
            margin-bottom: 2px;
        }

        .agent-email {
            font-size: 12px;
            color: #9CA3AF;
        }

        .agent-status-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .agent-status-badge.online {
            background: #D1FAE5;
            color: #065F46;
        }

        .agent-status-badge.offline {
            background: #FEE2E2;
            color: #991B1B;
        }

        .agent-status-badge.break {
            background: #FEF3C7;
            color: #92400E;
        }

        .agent-services {
            display: flex;
            gap: 4px;
            flex-wrap: wrap;
        }

        .agent-counter {
            padding: 4px 8px;
            background: #F3F4F6;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            color: #374151;
        }

        .agent-performance {
            text-align: center;
        }

        .performance-number {
            font-size: 16px;
            font-weight: 600;
            color: #10B981;
            display: block;
        }

        .performance-label {
            font-size: 11px;
            color: #6B7280;
        }

        .agent-role-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
            text-transform: uppercase;
        }

        .agent-role-badge.agent {
            background: #E0E7FF;
            color: #3730A3;
        }

        .agent-role-badge.supervisor {
            background: #FEF3C7;
            color: #92400E;
        }

        .agent-role-badge.admin {
            background: #FEE2E2;
            color: #991B1B;
        }

        .agent-actions {
            display: flex;
            gap: 8px;
        }

        .agent-action-btn {
            padding: 6px 8px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
            background: transparent;
        }

        .agent-action-btn:hover {
            background: #F3F4F6;
        }

        .agent-action-btn.edit {
            color: #3B82F6;
        }

        .agent-action-btn.delete {
            color: #EF4444;
        }

        .agent-action-btn.reset {
            color: #8B5CF6;
        }

        .online-agent-loading {
            text-align: center;
            color: #9CA3AF;
            font-style: italic;
            padding: 40px;
            grid-column: 1 / -1;
        }

        .agent-performance-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .agent-performance-item {
            background: #F9FAFB;
            border-radius: 8px;
            padding: 20px;
            border: 1px solid #F3F4F6;
            text-align: center;
        }

        .performance-agent-name {
            font-size: 16px;
            font-weight: 600;
            color: #1F2937;
            margin-bottom: 12px;
        }

        .performance-metrics {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-top: 12px;
        }

        .performance-metric {
            text-align: center;
        }

        .performance-metric-value {
            font-size: 18px;
            font-weight: 600;
            color: #10B981;
            display: block;
        }

        .performance-metric-label {
            font-size: 11px;
            color: #6B7280;
            margin-top: 2px;
        }

        /* FORM SECTIONS */
        .form-section {
            margin-bottom: 32px;
            padding-bottom: 24px;
            border-bottom: 1px solid #F3F4F6;
        }

        .form-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .form-section-title {
            font-size: 16px;
            font-weight: 600;
            color: #1F2937;
            margin-bottom: 8px;
        }

        .form-section-description {
            font-size: 14px;
            color: #6B7280;
            margin-bottom: 16px;
        }

        .form-help {
            display: block;
            font-size: 12px;
            color: #6B7280;
            margin-top: 4px;
        }

        /* SERVICE ASSIGNMENTS */
        .service-assignments {
            display: grid;
            gap: 12px;
        }

        .service-assignment {
            border: 1px solid #E5E7EB;
            border-radius: 8px;
            padding: 16px;
            background: #FAFAFA;
        }

        .service-checkbox {
            display: flex !important;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            margin-bottom: 0 !important;
        }

        .service-checkbox input[type="checkbox"] {
            width: auto !important;
            margin: 0;
        }

        .service-name {
            flex: 1;
            font-size: 14px;
            color: #374151;
            font-weight: 500;
        }

        .priority-select {
            width: auto !important;
            min-width: 100px;
            padding: 4px 8px !important;
            font-size: 12px;
        }

        /* SETTINGS MANAGEMENT STYLES */
        .settings-stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }

        .setting-stat-card {
            background: #FFFFFF;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            border: 1px solid #F3F4F6;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .setting-stat-content {
            flex: 1;
        }

        .setting-stat-value {
            font-size: 24px;
            font-weight: 700;
            color: #1F2937;
            line-height: 1;
            margin-bottom: 4px;
        }

        .setting-stat-label {
            font-size: 12px;
            color: #6B7280;
            font-weight: 500;
        }

        .setting-stat-icon {
            font-size: 24px;
            opacity: 0.7;
        }

        .settings-categories {
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        .settings-header-actions {
            display: flex;
            gap: 12px;
        }

        /* FEATURE FLAGS */
        .feature-flags-grid {
            display: grid;
            gap: 16px;
        }

        .feature-flag {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px;
            background: #F9FAFB;
            border-radius: 8px;
            border: 1px solid #F3F4F6;
            transition: all 0.2s;
        }

        .feature-flag:hover {
            background: #F3F4F6;
        }

        .feature-info {
            flex: 1;
        }

        .feature-name {
            font-size: 14px;
            font-weight: 600;
            color: #1F2937;
            margin-bottom: 4px;
        }

        .feature-description {
            font-size: 12px;
            color: #6B7280;
        }

        .feature-toggle {
            margin-left: 16px;
        }

        /* TOGGLE SWITCH */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 48px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #E5E7EB;
            transition: 0.3s;
            border-radius: 24px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: 0.3s;
            border-radius: 50%;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
        }

        input:checked + .toggle-slider {
            background-color: #10B981;
        }

        input:checked + .toggle-slider:before {
            transform: translateX(24px);
        }

        /* CONFIGURATION SECTIONS */
        .config-grid {
            display: flex;
            flex-direction: column;
            gap: 32px;
        }

        .config-section {
            padding-bottom: 24px;
            border-bottom: 1px solid #F3F4F6;
        }

        .config-section:last-child {
            border-bottom: none;
            padding-bottom: 0;
        }

        .config-section-title {
            font-size: 16px;
            font-weight: 600;
            color: #1F2937;
            margin-bottom: 16px;
        }

        .config-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
            margin-bottom: 16px;
        }

        .config-row:last-child {
            margin-bottom: 0;
        }

        .config-group {
            display: flex;
            flex-direction: column;
        }

        .config-group label {
            font-size: 14px;
            font-weight: 500;
            color: #374151;
            margin-bottom: 8px;
        }

        .config-group input,
        .config-group select {
            padding: 10px 14px;
            border: 1px solid #E5E7EB;
            border-radius: 6px;
            font-size: 14px;
            background: #FFFFFF;
            color: #1F2937;
            transition: border-color 0.2s;
        }

        .config-group input:focus,
        .config-group select:focus {
            outline: none;
            border-color: #10B981;
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }

        .config-help {
            font-size: 12px;
            color: #6B7280;
            margin-top: 4px;
        }

        /* LANGUAGE SETTINGS */
        .language-settings {
            display: flex;
            flex-direction: column;
            gap: 32px;
        }

        .language-section {
            padding-bottom: 24px;
            border-bottom: 1px solid #F3F4F6;
        }

        .language-section:last-child {
            border-bottom: none;
            padding-bottom: 0;
        }

        .language-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
        }

        .language-item {
            background: #F9FAFB;
            border-radius: 8px;
            padding: 16px;
            border: 1px solid #F3F4F6;
        }

        .language-checkbox {
            display: flex !important;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            margin-bottom: 0 !important;
        }

        .language-checkbox input[type="checkbox"] {
            width: auto !important;
            margin: 0;
        }

        .language-flag {
            font-size: 20px;
        }

        .language-name {
            flex: 1;
            font-size: 14px;
            font-weight: 500;
            color: #1F2937;
        }

        .language-status {
            font-size: 11px;
            padding: 2px 8px;
            border-radius: 10px;
            font-weight: 500;
        }

        .language-status:contains("Default") {
            background: #FEE2E2;
            color: #991B1B;
        }

        .language-item:has(input:checked) .language-status {
            background: #D1FAE5;
            color: #065F46;
        }

        .language-item:has(input:not(:checked)) .language-status {
            background: #F3F4F6;
            color: #6B7280;
        }

        /* MAINTENANCE GRID */
        .maintenance-grid {
            display: flex;
            flex-direction: column;
            gap: 32px;
        }

        .maintenance-section {
            padding-bottom: 24px;
            border-bottom: 1px solid #F3F4F6;
        }

        .maintenance-section:last-child {
            border-bottom: none;
            padding-bottom: 0;
        }

        /* SETTINGS LOG */
        .settings-log {
            max-height: 300px;
            overflow-y: auto;
        }

        .log-item {
            display: grid;
            grid-template-columns: 120px 120px 1fr;
            gap: 16px;
            padding: 12px 0;
            border-bottom: 1px solid #F9FAFB;
            font-size: 14px;
        }

        .log-item:last-child {
            border-bottom: none;
        }

        .log-time {
            color: #6B7280;
            font-size: 12px;
        }

        .log-user {
            color: #8B5CF6;
            font-weight: 500;
            font-size: 12px;
        }

        .log-change {
            color: #374151;
        }

        /* REPORTS & ANALYTICS STYLES */
        .reports-stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }

        .report-stat-card {
            background: #FFFFFF;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            border: 1px solid #F3F4F6;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .report-stat-content {
            flex: 1;
        }

        .report-stat-value {
            font-size: 24px;
            font-weight: 700;
            color: #1F2937;
            line-height: 1;
            margin-bottom: 4px;
        }

        .report-stat-label {
            font-size: 12px;
            color: #6B7280;
            font-weight: 500;
        }

        .report-stat-icon {
            font-size: 24px;
            opacity: 0.7;
        }

        .reports-header-actions {
            display: flex;
            align-items: center;
            gap: 16px;
            flex-wrap: wrap;
        }

        .date-range-picker {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }

        .date-range-picker label {
            color: #6B7280;
            font-weight: 500;
        }

        .date-range-picker input {
            padding: 8px 12px;
            border: 1px solid #E5E7EB;
            border-radius: 6px;
            font-size: 14px;
        }

        .reports-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 24px;
            margin-bottom: 24px;
        }

        .chart-card {
            min-height: 400px;
        }

        .chart-controls {
            display: flex;
            gap: 8px;
        }

        .chart-controls select {
            padding: 6px 12px;
            border: 1px solid #E5E7EB;
            border-radius: 6px;
            font-size: 12px;
            background: #FFFFFF;
        }

        .chart-container {
            padding: 20px;
            height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #F9FAFB;
            border-radius: 8px;
            margin: 16px 0;
        }

        .chart-container canvas {
            max-width: 100%;
            max-height: 100%;
        }

        /* Service Distribution */
        .service-breakdown {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .breakdown-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 12px;
            background: #F9FAFB;
            border-radius: 6px;
        }

        .service-percentage {
            margin-left: auto;
            font-weight: 600;
            color: #1F2937;
        }

        /* Agent Performance Table */
        .performance-period-selector {
            display: flex;
            gap: 4px;
        }

        .period-btn {
            padding: 6px 16px;
            border: 1px solid #E5E7EB;
            background: #FFFFFF;
            color: #6B7280;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 14px;
        }

        .period-btn:hover {
            background: #F3F4F6;
        }

        .period-btn.active {
            background: #10B981;
            color: white;
            border-color: #10B981;
        }

        .agent-performance-table {
            overflow-x: auto;
            margin-top: 16px;
        }

        .performance-table {
            width: 100%;
            border-collapse: collapse;
            background: #FFFFFF;
        }

        .performance-table th {
            background: #F9FAFB;
            color: #374151;
            font-weight: 600;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            padding: 12px 16px;
            text-align: left;
            border-bottom: 1px solid #E5E7EB;
        }

        .performance-table td {
            padding: 16px;
            border-bottom: 1px solid #F3F4F6;
            font-size: 14px;
            color: #374151;
            vertical-align: middle;
        }

        .performance-table tbody tr:hover {
            background: #F9FAFB;
        }

        .rating-display {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .stars {
            font-size: 12px;
        }

        .efficiency-bar {
            position: relative;
            background: #F3F4F6;
            border-radius: 10px;
            height: 20px;
            min-width: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .efficiency-fill {
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            background: #10B981;
            border-radius: 10px;
            transition: width 0.3s ease;
        }

        .efficiency-bar span {
            position: relative;
            z-index: 1;
            font-size: 12px;
            font-weight: 600;
            color: #1F2937;
        }

        /* Wait Time Metrics */
        .wait-time-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .metric-item {
            text-align: center;
            padding: 16px;
            background: #F9FAFB;
            border-radius: 8px;
        }

        .metric-label {
            font-size: 12px;
            color: #6B7280;
            margin-bottom: 8px;
        }

        .metric-value {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .metric-value.excellent { color: #059669; }
        .metric-value.good { color: #10B981; }
        .metric-value.warning { color: #F59E0B; }
        .metric-value.poor { color: #EF4444; }

        .metric-trend {
            font-size: 12px;
            font-weight: 500;
        }

        .metric-trend.up { color: #059669; }
        .metric-trend.down { color: #EF4444; }

        .wait-time-breakdown h4 {
            font-size: 16px;
            color: #1F2937;
            margin-bottom: 16px;
        }

        .wait-time-bars {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .wait-bar {
            display: grid;
            grid-template-columns: 80px 1fr 60px;
            align-items: center;
            gap: 12px;
        }

        .wait-label {
            font-size: 12px;
            color: #6B7280;
            font-weight: 500;
        }

        .wait-progress {
            background: #F3F4F6;
            border-radius: 10px;
            height: 16px;
            position: relative;
        }

        .wait-fill {
            height: 100%;
            border-radius: 10px;
            transition: width 0.3s ease;
        }

        .wait-fill.excellent { background: #059669; }
        .wait-fill.good { background: #10B981; }
        .wait-fill.warning { background: #F59E0B; }
        .wait-fill.poor { background: #EF4444; }

        .wait-percentage {
            font-size: 12px;
            font-weight: 600;
            color: #1F2937;
            text-align: right;
        }

        /* Peak Hours Analysis */
        .peak-hours-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 8px;
            margin-bottom: 24px;
        }

        .hour-block {
            text-align: center;
            padding: 16px 8px;
            border-radius: 8px;
            border: 2px solid transparent;
        }

        .hour-block.low {
            background: #F0FDF4;
            border-color: #BBF7D0;
        }

        .hour-block.medium {
            background: #FFFBEB;
            border-color: #FED7AA;
        }

        .hour-block.high {
            background: #FEF3C7;
            border-color: #FCD34D;
        }

        .hour-block.peak {
            background: #FEE2E2;
            border-color: #FCA5A5;
        }

        .hour-time {
            font-size: 12px;
            font-weight: 600;
            color: #1F2937;
            margin-bottom: 4px;
        }

        .hour-load {
            font-size: 14px;
            font-weight: 700;
            color: #374151;
        }

        .peak-insights {
            background: #F9FAFB;
            padding: 16px;
            border-radius: 8px;
            border: 1px solid #F3F4F6;
        }

        .insight-item {
            font-size: 14px;
            color: #374151;
            margin-bottom: 8px;
        }

        .insight-item:last-child {
            margin-bottom: 0;
        }

        /* Export Options */
        .export-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 32px;
        }

        .export-section h4 {
            font-size: 16px;
            font-weight: 600;
            color: #1F2937;
            margin-bottom: 16px;
        }

        .export-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .export-btn {
            padding: 12px 16px;
            border: 1px solid #E5E7EB;
            background: #FFFFFF;
            color: #374151;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 14px;
            text-align: center;
        }

        .export-btn:hover {
            background: #F9FAFB;
            border-color: #10B981;
            color: #059669;
        }

        .custom-export {
            background: #F9FAFB;
            padding: 16px;
            border-radius: 8px;
            border: 1px solid #F3F4F6;
        }

        .export-controls {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .export-controls select {
            padding: 10px 14px;
            border: 1px solid #E5E7EB;
            border-radius: 6px;
            font-size: 14px;
            background: #FFFFFF;
        }

        /* MAINTENANCE & SYSTEM HEALTH STYLES */
        .maintenance-stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }

        .maintenance-stat-card {
            background: #FFFFFF;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            border: 1px solid #F3F4F6;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-left: 4px solid;
        }

        .maintenance-stat-card.healthy { border-left-color: #10B981; }
        .maintenance-stat-card.good { border-left-color: #3B82F6; }
        .maintenance-stat-card.excellent { border-left-color: #8B5CF6; }
        .maintenance-stat-card.warning { border-left-color: #F59E0B; }
        .maintenance-stat-card.critical { border-left-color: #EF4444; }

        .maintenance-stat-content {
            flex: 1;
        }

        .maintenance-stat-value {
            font-size: 24px;
            font-weight: 700;
            color: #1F2937;
            line-height: 1;
            margin-bottom: 4px;
        }

        .maintenance-stat-label {
            font-size: 12px;
            color: #6B7280;
            font-weight: 500;
        }

        .maintenance-stat-icon {
            font-size: 24px;
            opacity: 0.7;
        }

        .maintenance-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
            margin-bottom: 24px;
        }

        /* Quick Actions */
        .maintenance-quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
        }

        .maintenance-action-btn {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 20px;
            background: #FFFFFF;
            border: 1px solid #E5E7EB;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: left;
        }

        .maintenance-action-btn:hover {
            background: #F9FAFB;
            border-color: #10B981;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .maintenance-action-btn.backup:hover { border-color: #3B82F6; }
        .maintenance-action-btn.optimize:hover { border-color: #10B981; }
        .maintenance-action-btn.logs:hover { border-color: #F59E0B; }
        .maintenance-action-btn.restart:hover { border-color: #EF4444; }

        .action-icon {
            font-size: 32px;
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .action-text {
            flex: 1;
        }

        .action-title {
            font-size: 16px;
            font-weight: 600;
            color: #1F2937;
            margin-bottom: 4px;
        }

        .action-desc {
            font-size: 13px;
            color: #6B7280;
        }

        /* Health Status */
        .health-status-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .status-dot.healthy { background: #10B981; }
        .status-dot.warning { background: #F59E0B; }
        .status-dot.critical { background: #EF4444; }

        .status-text {
            font-size: 14px;
            color: #059669;
            font-weight: 500;
        }

        .health-metrics {
            display: flex;
            flex-direction: column;
            gap: 16px;
            margin-bottom: 24px;
        }

        .health-metric {
            background: #F9FAFB;
            padding: 16px;
            border-radius: 8px;
            border: 1px solid #F3F4F6;
        }

        .metric-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .metric-name {
            font-size: 14px;
            font-weight: 500;
            color: #374151;
        }

        .metric-value {
            font-size: 14px;
            font-weight: 600;
            color: #1F2937;
        }

        .metric-bar {
            background: #E5E7EB;
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
        }

        .metric-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .metric-fill.excellent { background: #10B981; }
        .metric-fill.good { background: #3B82F6; }
        .metric-fill.warning { background: #F59E0B; }
        .metric-fill.critical { background: #EF4444; }

        .health-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .detail-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 12px;
            background: #F9FAFB;
            border-radius: 6px;
            font-size: 13px;
        }

        .detail-label {
            color: #6B7280;
        }

        .detail-value {
            font-weight: 500;
            color: #1F2937;
        }

        /* Database Management */
        .database-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }

        .db-stat {
            text-align: center;
            padding: 16px;
            background: #F9FAFB;
            border-radius: 8px;
            border: 1px solid #F3F4F6;
        }

        .db-stat-label {
            font-size: 12px;
            color: #6B7280;
            margin-bottom: 8px;
        }

        .db-stat-value {
            font-size: 18px;
            font-weight: 700;
            color: #1F2937;
        }

        .database-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .db-action-btn {
            padding: 12px 16px;
            background: #FFFFFF;
            border: 1px solid #E5E7EB;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 14px;
            color: #374151;
        }

        .db-action-btn:hover {
            background: #F9FAFB;
            border-color: #10B981;
            color: #059669;
        }

        /* Log Management */
        .log-controls {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .log-controls select {
            padding: 8px 12px;
            border: 1px solid #E5E7EB;
            border-radius: 6px;
            font-size: 14px;
            background: #FFFFFF;
        }

        .log-viewer {
            background: #1F2937;
            border-radius: 8px;
            padding: 16px;
            max-height: 400px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
        }

        .log-entry {
            display: grid;
            grid-template-columns: 140px 60px 1fr;
            gap: 12px;
            padding: 8px 0;
            border-bottom: 1px solid #374151;
            font-size: 13px;
        }

        .log-entry:last-child {
            border-bottom: none;
        }

        .log-timestamp {
            color: #9CA3AF;
        }

        .log-level {
            font-weight: 600;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 11px;
            text-align: center;
        }

        .log-entry.error .log-level {
            background: #FEE2E2;
            color: #991B1B;
        }

        .log-entry.warning .log-level {
            background: #FEF3C7;
            color: #92400E;
        }

        .log-entry.info .log-level {
            background: #DBEAFE;
            color: #1E40AF;
        }

        .log-entry.debug .log-level {
            background: #F3F4F6;
            color: #374151;
        }

        .log-message {
            color: #E5E7EB;
        }

        /* Backup Management */
        .backup-status {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding: 20px;
            background: #F9FAFB;
            border-radius: 8px;
            border: 1px solid #F3F4F6;
        }

        .backup-info {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .backup-item {
            display: flex;
            gap: 12px;
            font-size: 14px;
        }

        .backup-label {
            color: #6B7280;
            min-width: 100px;
        }

        .backup-value {
            font-weight: 500;
            color: #1F2937;
        }

        .backup-value.enabled {
            color: #059669;
        }

        .backup-now-btn {
            padding: 12px 24px;
            background: #10B981;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: background-color 0.2s;
        }

        .backup-now-btn:hover {
            background: #059669;
        }

        .backup-history h4 {
            font-size: 16px;
            color: #1F2937;
            margin-bottom: 16px;
        }

        .backup-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .backup-file {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            background: #F9FAFB;
            border-radius: 8px;
            border: 1px solid #F3F4F6;
        }

        .backup-file-info {
            flex: 1;
        }

        .backup-filename {
            font-size: 14px;
            font-weight: 500;
            color: #1F2937;
            margin-bottom: 4px;
        }

        .backup-date {
            font-size: 12px;
            color: #6B7280;
        }

        .backup-actions {
            display: flex;
            gap: 8px;
        }

        .backup-action {
            width: 32px;
            height: 32px;
            border: 1px solid #E5E7EB;
            background: #FFFFFF;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            font-size: 14px;
        }

        .backup-action:hover {
            background: #F3F4F6;
        }

        .backup-action.download:hover {
            border-color: #3B82F6;
            color: #3B82F6;
        }

        .backup-action.restore:hover {
            border-color: #F59E0B;
            color: #F59E0B;
        }

        /* Performance Monitoring */
        .performance-overview {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }

        .perf-metric {
            text-align: center;
            padding: 20px;
            background: #F9FAFB;
            border-radius: 8px;
            border: 1px solid #F3F4F6;
        }

        .perf-label {
            font-size: 12px;
            color: #6B7280;
            margin-bottom: 8px;
        }

        .perf-value {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .perf-value.excellent { color: #059669; }
        .perf-value.good { color: #3B82F6; }
        .perf-value.warning { color: #F59E0B; }
        .perf-value.critical { color: #EF4444; }

        .perf-trend {
            font-size: 12px;
            font-weight: 500;
        }

        .perf-trend.up { color: #059669; }
        .perf-trend.down { color: #EF4444; }

        .performance-actions {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }

        .perf-action-btn {
            padding: 12px 16px;
            background: #FFFFFF;
            border: 1px solid #E5E7EB;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 13px;
            color: #374151;
            text-align: center;
        }

        .perf-action-btn:hover {
            background: #F9FAFB;
            border-color: #10B981;
            color: #059669;
        }

        /* System Diagnostics */
        .diagnostics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 16px;
        }

        .diagnostic-test {
            padding: 16px;
            background: #F9FAFB;
            border-radius: 8px;
            border: 1px solid #F3F4F6;
        }

        .test-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .test-name {
            font-size: 14px;
            font-weight: 500;
            color: #1F2937;
        }

        .test-status {
            font-size: 12px;
            font-weight: 600;
            padding: 4px 8px;
            border-radius: 12px;
        }

        .test-status.passed {
            background: #D1FAE5;
            color: #065F46;
        }

        .test-status.warning {
            background: #FEF3C7;
            color: #92400E;
        }

        .test-status.failed {
            background: #FEE2E2;
            color: #991B1B;
        }

        .test-details {
            font-size: 13px;
            color: #6B7280;
        }

        /* UTILITY CLASSES */
        .text-center { text-align: center; }
        .mb-16 { margin-bottom: 16px; }
        .mb-24 { margin-bottom: 24px; }
        .hidden { display: none; }

        /* RESPONSIVE MAINTENANCE */
        @media (max-width: 768px) {
            .maintenance-stats-grid {
                grid-template-columns: 1fr;
                gap: 16px;
            }

            .maintenance-grid {
                grid-template-columns: 1fr;
                gap: 16px;
            }

            .maintenance-quick-actions {
                grid-template-columns: 1fr;
            }

            .log-controls {
                flex-direction: column;
                gap: 8px;
            }

            .log-entry {
                grid-template-columns: 1fr;
                gap: 8px;
            }

            .backup-status {
                flex-direction: column;
                gap: 16px;
                text-align: center;
            }

            .database-stats {
                grid-template-columns: 1fr;
            }

            .database-actions {
                grid-template-columns: 1fr;
            }

            .performance-overview {
                grid-template-columns: 1fr;
            }

            .performance-actions {
                grid-template-columns: 1fr;
            }

            .health-details {
                grid-template-columns: 1fr;
            }

            .diagnostics-grid {
                grid-template-columns: 1fr;
            }
        }

        /* RESPONSIVE REPORTS */
        @media (max-width: 768px) {
            .reports-stats-grid {
                grid-template-columns: 1fr;
                gap: 16px;
            }

            .reports-header-actions {
                flex-direction: column;
                align-items: stretch;
                gap: 12px;
            }

            .date-range-picker {
                justify-content: space-between;
            }

            .reports-grid {
                grid-template-columns: 1fr;
                gap: 16px;
            }

            .wait-time-metrics {
                grid-template-columns: 1fr;
            }

            .peak-hours-grid {
                grid-template-columns: repeat(4, 1fr);
            }

            .export-options {
                grid-template-columns: 1fr;
                gap: 24px;
            }

            .export-buttons {
                grid-template-columns: 1fr;
            }

            .performance-table {
                font-size: 12px;
            }

            .performance-table th,
            .performance-table td {
                padding: 8px 12px;
            }
        }

        /* RESPONSIVE SETTINGS */
        @media (max-width: 768px) {
            .settings-stats-grid {
                grid-template-columns: 1fr;
                gap: 16px;
            }

            .settings-header-actions {
                flex-direction: column;
                gap: 8px;
            }

            .config-row {
                grid-template-columns: 1fr;
                gap: 16px;
            }

            .language-grid {
                grid-template-columns: 1fr;
            }

            .log-item {
                grid-template-columns: 1fr;
                gap: 8px;
            }

            .feature-flag {
                flex-direction: column;
                align-items: flex-start;
                gap: 12px;
            }

            .feature-toggle {
                margin-left: 0;
                align-self: flex-end;
            }
        }

        /* RESPONSIVE AGENTS */
        @media (max-width: 768px) {
            .agents-stats-grid {
                grid-template-columns: 1fr;
                gap: 16px;
            }

            .agents-header-actions {
                flex-direction: column;
                gap: 12px;
            }

            .online-agents-grid {
                grid-template-columns: 1fr;
            }

            .agents-table-container {
                font-size: 12px;
            }

            .agents-table th,
            .agents-table td {
                padding: 8px 12px;
            }

            .agent-services {
                flex-direction: column;
                gap: 8px;
            }

            .agent-performance-grid {
                grid-template-columns: 1fr;
            }

            .performance-metrics {
                grid-template-columns: 1fr;
            }
        }

        /* RESPONSIVE SERVICES */
        @media (max-width: 768px) {
            .services-stats-grid {
                grid-template-columns: 1fr;
                gap: 16px;
            }

            .services-header-actions {
                flex-direction: column;
                gap: 12px;
            }

            .search-box input {
                width: 100%;
            }

            .services-table-container {
                font-size: 12px;
            }

            .services-table th,
            .services-table td {
                padding: 8px 12px;
            }

            .form-row {
                grid-template-columns: 1fr;
                gap: 0;
            }

            .modal-content {
                width: 95%;
                margin: 20px;
            }
        }

        /* RESPONSIVE */
        @media (max-width: 768px) {
            .admin-sidebar {
                position: fixed;
                left: -256px;
                height: 100vh;
                z-index: 200;
                transition: left 0.3s;
            }
            
            .admin-sidebar.open {
                left: 0;
            }
            
            .admin-main {
                padding: 16px;
            }
        }
    </style>
</head>
<body>
    <!-- LOGIN SCREEN -->
    <div id="loginScreen" class="login-container">
        <div class="login-card">
            <div class="login-header">
                <h1>FlowMatic Admin</h1>
                <p>System Administration Panel</p>
            </div>
            
            <div id="loginError" class="error-message hidden">
                Invalid password. Please try again.
            </div>
            
            <form id="loginForm">
                <div class="form-group">
                    <label for="password">Admin Password</label>
                    <input type="password" id="password" required autocomplete="current-password">
                </div>
                
                <button type="submit" id="loginButton" class="login-button">
                    Sign In
                </button>
            </form>
        </div>
    </div>

    <!-- MAIN ADMIN INTERFACE -->
    <div id="adminLayout" class="admin-layout">
        <!-- Header -->
        <header class="admin-header">
            <h1>FlowMatic Administration</h1>
            <div class="admin-header-right">
                <span class="admin-user">Admin User</span>
                <button id="logoutButton" class="logout-button">Logout</button>
            </div>
        </header>

        <div class="admin-content">
            <!-- Sidebar Navigation -->
            <nav class="admin-sidebar">
                <a href="#dashboard" class="nav-item active" data-section="dashboard">
                    <span class="nav-item-icon"></span>
                    Dashboard
                </a>
                <a href="#services" class="nav-item" data-section="services">
                    <span class="nav-item-icon"></span>
                    Services
                </a>
                <a href="#counters" class="nav-item" data-section="counters">
                    <span class="nav-item-icon"></span>
                    Counters
                </a>
                <a href="#agents" class="nav-item" data-section="agents">
                    <span class="nav-item-icon"></span>
                    Agents
                </a>
                <a href="#settings" class="nav-item" data-section="settings">
                    <span class="nav-item-icon"></span>
                    Settings
                </a>
                <a href="#reports" class="nav-item" data-section="reports">
                    <span class="nav-item-icon"></span>
                    Reports
                </a>
                <a href="#maintenance" class="nav-item" data-section="maintenance">
                    <span class="nav-item-icon"></span>
                    Maintenance
                </a>
            </nav>

            <!-- Main Content Area -->
            <main class="admin-main">
                <!-- Dashboard Section -->
                <section id="dashboard-section" class="admin-section active">
                    <div class="section-header">
                        <h2 class="section-title">System Dashboard</h2>
                        <p class="section-description">Real-time overview of your queue management system</p>
                    </div>

                    <!-- Stats Cards Row -->
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon green"></div>
                            <div class="stat-content">
                                <div class="stat-value" id="ticketsToday">--</div>
                                <div class="stat-label">Tickets Today</div>
                            </div>
                            <div class="stat-trend" id="ticketsTrend">+0</div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-icon orange"></div>
                            <div class="stat-content">
                                <div class="stat-value" id="activeQueues">--</div>
                                <div class="stat-label">Active Queues</div>
                            </div>
                            <div class="stat-trend" id="queuesTrend">0 waiting</div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-icon purple"></div>
                            <div class="stat-content">
                                <div class="stat-value" id="agentsOnline">--</div>
                                <div class="stat-label">Agents Online</div>
                            </div>
                            <div class="stat-trend" id="agentsTrend">0/0</div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-icon blue"></div>
                            <div class="stat-content">
                                <div class="stat-value" id="avgWait">--</div>
                                <div class="stat-label">Avg Wait Time</div>
                            </div>
                            <div class="stat-trend" id="waitTrend">minutes</div>
                        </div>
                    </div>

                    <!-- Main Content Grid -->
                    <div class="dashboard-grid">
                        <!-- Live Activity Feed -->
                        <div class="card activity-card">
                            <div class="card-header">
                                <h3 class="card-title">Live Activity</h3>
                                <div class="refresh-indicator" id="activityIndicator"></div>
                            </div>
                            <div class="activity-feed" id="activityFeed">
                                <div class="activity-item loading">
                                    <span class="activity-time">--:--</span>
                                    <span class="activity-text">Loading system activity...</span>
                                </div>
                            </div>
                        </div>

                        <!-- Queue Status -->
                        <div class="card queue-status-card">
                            <div class="card-header">
                                <h3 class="card-title">Current Queue Status</h3>
                                <button class="refresh-btn" onclick="refreshQueues()"></button>
                            </div>
                            <div class="queue-list" id="queueList">
                                <div class="queue-item loading">
                                    <span class="service-badge">Loading...</span>
                                    <span class="queue-count">--</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Quick Actions</h3>
                        </div>
                        <div class="quick-actions">
                            <button class="action-btn primary" onclick="resetQueue()">
                                 Reset Queue
                            </button>
                            <button class="action-btn secondary" onclick="addAgentFromDashboard()">
                                 Add Agent
                            </button>
                            <button class="action-btn info" onclick="toggleFeature()">
                                 Toggle Feature
                            </button>
                            <button class="action-btn warning" onclick="systemHealth()">
                                 System Health
                            </button>
                        </div>
                    </div>

                    <!-- System Health -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">System Health</h3>
                        </div>
                        <div class="health-indicators">
                            <div class="health-item">
                                <span class="health-label">Database</span>
                                <span class="health-status online" id="dbStatus"></span>
                            </div>
                            <div class="health-item">
                                <span class="health-label">Socket.IO</span>
                                <span class="health-status online" id="socketStatus"></span>
                            </div>
                            <div class="health-item">
                                <span class="health-label">Memory Usage</span>
                                <span class="health-value" id="memoryUsage">--</span>
                            </div>
                            <div class="health-item">
                                <span class="health-label">Uptime</span>
                                <span class="health-value" id="uptime">--</span>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Services Section -->
                <section id="services-section" class="admin-section">
                    <div class="section-header">
                        <h2 class="section-title">Services Management</h2>
                        <p class="section-description">Configure and manage your service types</p>
                    </div>

                    <!-- Services Statistics Cards -->
                    <div class="services-stats-grid">
                        <div class="service-stat-card">
                            <div class="service-stat-content">
                                <div class="service-stat-value" id="totalServices">4</div>
                                <div class="service-stat-label">Total Services</div>
                            </div>
                            <div class="service-stat-icon"></div>
                        </div>
                        <div class="service-stat-card">
                            <div class="service-stat-content">
                                <div class="service-stat-value" id="activeServices">4</div>
                                <div class="service-stat-label">Active Services</div>
                            </div>
                            <div class="service-stat-icon"></div>
                        </div>
                        <div class="service-stat-card">
                            <div class="service-stat-content">
                                <div class="service-stat-value" id="totalTicketsToday">47</div>
                                <div class="service-stat-label">Tickets Today</div>
                            </div>
                            <div class="service-stat-icon"></div>
                        </div>
                        <div class="service-stat-card">
                            <div class="service-stat-content">
                                <div class="service-stat-value" id="avgServiceTime">4.2m</div>
                                <div class="service-stat-label">Avg Service Time</div>
                            </div>
                            <div class="service-stat-icon"></div>
                        </div>
                    </div>

                    <!-- Services Management Card -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Services Configuration</h3>
                            <div class="services-header-actions">
                                <button class="action-btn primary" onclick="addService()">
                                     Add Service
                                </button>
                                <div class="search-box">
                                    <input type="text" id="servicesSearch" placeholder="Search services..." onkeyup="filterServices()">
                                </div>
                            </div>
                        </div>

                        <div class="services-table-container">
                            <table class="services-table" id="servicesTable">
                                <thead>
                                    <tr>
                                        <th>Service Name</th>
                                        <th>Prefix</th>
                                        <th>Number Range</th>
                                        <th>Current Number</th>
                                        <th>Status</th>
                                        <th>Today's Tickets</th>
                                        <th>Avg Wait</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="servicesTableBody">
                                    <!-- Services will be loaded here -->
                                    <tr class="loading-row">
                                        <td colspan="8" class="text-center">Loading services...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Service Performance Card -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Service Performance Today</h3>
                            <button class="refresh-btn" onclick="refreshServiceStats()"></button>
                        </div>
                        <div class="service-performance-grid" id="servicePerformanceGrid">
                            <!-- Performance charts will be loaded here -->
                            <div class="performance-loading">Loading performance data...</div>
                        </div>
                    </div>
                </section>

                <!-- Add/Edit Service Modal -->
                <div id="serviceModal" class="modal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3 id="serviceModalTitle">Add New Service</h3>
                            <button class="modal-close" onclick="closeServiceModal()">&times;</button>
                        </div>
                        <form id="serviceForm" onsubmit="saveService(event)">
                            <div class="modal-body">
                                <input type="hidden" id="serviceId" name="serviceId">
                                
                                <div class="form-group">
                                    <label for="serviceName">Service Name *</label>
                                    <input type="text" id="serviceName" name="serviceName" required 
                                           placeholder="e.g., General Service, VIP Support">
                                </div>

                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="servicePrefix">Prefix *</label>
                                        <input type="text" id="servicePrefix" name="servicePrefix" required 
                                               maxlength="3" placeholder="e.g., A, B, VIP" style="text-transform: uppercase;">
                                    </div>
                                    <div class="form-group">
                                        <label for="serviceDescription">Description</label>
                                        <input type="text" id="serviceDescription" name="serviceDescription" 
                                               placeholder="Brief description of the service">
                                    </div>
                                </div>

                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="rangeStart">Range Start *</label>
                                        <input type="number" id="rangeStart" name="rangeStart" required 
                                               min="1" max="9999" placeholder="1">
                                    </div>
                                    <div class="form-group">
                                        <label for="rangeEnd">Range End *</label>
                                        <input type="number" id="rangeEnd" name="rangeEnd" required 
                                               min="1" max="9999" placeholder="999">
                                    </div>
                                </div>

                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="currentNumber">Current Number</label>
                                        <input type="number" id="currentNumber" name="currentNumber" 
                                               min="0" placeholder="0">
                                    </div>
                                    <div class="form-group">
                                        <label for="estimatedServiceTime">Est. Service Time (seconds)</label>
                                        <input type="number" id="estimatedServiceTime" name="estimatedServiceTime" 
                                               min="30" max="3600" placeholder="300">
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="isActive" name="isActive" checked>
                                        <span class="checkmark"></span>
                                        Service is active
                                    </label>
                                </div>

                                <div class="validation-messages" id="validationMessages"></div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="action-btn secondary" onclick="closeServiceModal()">
                                    Cancel
                                </button>
                                <button type="submit" class="action-btn primary">
                                    <span id="saveButtonText">Save Service</span>
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Confirm Delete Modal -->
                <div id="deleteConfirmModal" class="modal">
                    <div class="modal-content small">
                        <div class="modal-header">
                            <h3>Confirm Delete</h3>
                            <button class="modal-close" onclick="closeDeleteModal()">&times;</button>
                        </div>
                        <div class="modal-body">
                            <p>Are you sure you want to delete the service "<span id="deleteServiceName"></span>"?</p>
                            <p class="warning-text"> This action cannot be undone. Any active tickets for this service will be affected.</p>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="action-btn secondary" onclick="closeDeleteModal()">
                                Cancel
                            </button>
                            <button type="button" class="action-btn warning" onclick="confirmDeleteService()">
                                Delete Service
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Counters Section -->
                <section id="counters-section" class="admin-section">
                    <div class="section-header">
                        <h2 class="section-title">Counters Management</h2>
                        <p class="section-description">Configure serving counters and locations</p>
                    </div>
                    
                    <!-- Counter Statistics Cards -->
                    <div class="counter-stats-grid">
                        <div class="counter-stat-card">
                            <div class="counter-stat-content">
                                <div class="counter-stat-value" id="totalCounters">5</div>
                                <div class="counter-stat-label">Total Counters</div>
                            </div>
                            <div class="counter-stat-icon"></div>
                        </div>
                        <div class="counter-stat-card">
                            <div class="counter-stat-content">
                                <div class="counter-stat-value" id="activeCounters">3</div>
                                <div class="counter-stat-label">Active Now</div>
                            </div>
                            <div class="counter-stat-icon"></div>
                        </div>
                        <div class="counter-stat-card">
                            <div class="counter-stat-content">
                                <div class="counter-stat-value" id="busiestCounter">Counter 2</div>
                                <div class="counter-stat-label">Busiest Counter</div>
                            </div>
                            <div class="counter-stat-icon"></div>
                        </div>
                        <div class="counter-stat-card">
                            <div class="counter-stat-content">
                                <div class="counter-stat-value" id="totalServedToday">142</div>
                                <div class="counter-stat-label">Served Today</div>
                            </div>
                            <div class="counter-stat-icon"></div>
                        </div>
                    </div>

                    <!-- Counter Status Display -->
                    <div class="counter-status-grid">
                        <!-- Counter status cards will be dynamically loaded here -->
                    </div>

                    <!-- Counters Management Table -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Counter Configuration</h3>
                            <div class="card-actions">
                                <button class="refresh-btn" onclick="refreshCounters()"> Refresh</button>
                                <button class="action-btn primary" onclick="openAddCounterModal()">
                                    + Add Counter
                                </button>
                            </div>
                        </div>
                        <div class="table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Counter</th>
                                        <th>Name</th>
                                        <th>Location</th>
                                        <th>Agent</th>
                                        <th>Services</th>
                                        <th>Status</th>
                                        <th>Tickets Today</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="countersTableBody">
                                    <!-- Counter rows will be dynamically loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Counter Performance Chart -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Counter Performance (Last 7 Days)</h3>
                        </div>
                        <div class="chart-container">
                            <canvas id="counterPerformanceChart"></canvas>
                        </div>
                    </div>
                </section>

                <!-- Add/Edit Counter Modal -->
                <div id="addCounterModal" class="modal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3 id="counterModalTitle">Add New Counter</h3>
                            <button class="modal-close" onclick="closeCounterModal()">&times;</button>
                        </div>
                        <form id="counterForm" onsubmit="saveCounter(event)">
                            <div class="modal-body">
                                <input type="hidden" id="counterId" name="counterId">
                                
                                <!-- Counter Details -->
                                <div class="form-section">
                                    <h4 class="form-section-title">Counter Details</h4>
                                    
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="counterNumber">Counter Number*</label>
                                            <input type="number" id="counterNumber" name="counterNumber" 
                                                   required min="1" max="99" placeholder="1">
                                        </div>
                                        <div class="form-group">
                                            <label for="counterName">Display Name*</label>
                                            <input type="text" id="counterName" name="counterName" 
                                                   required placeholder="Counter 1">
                                        </div>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="counterLocation">Location</label>
                                        <input type="text" id="counterLocation" name="counterLocation" 
                                               placeholder="Ground Floor, Hall A">
                                    </div>
                                </div>

                                <!-- Service Assignments -->
                                <div class="form-section">
                                    <h4 class="form-section-title">Service Assignments</h4>
                                    <p class="form-section-description">Select which services this counter can handle</p>
                                    
                                    <div class="service-assignments" id="counterServiceAssignments">
                                        <div class="service-assignment">
                                            <label class="service-checkbox">
                                                <input type="checkbox" name="counterServices" value="1" data-service="A">
                                                <span class="service-badge general">A</span>
                                                <span class="service-name">General Service</span>
                                            </label>
                                        </div>
                                        <div class="service-assignment">
                                            <label class="service-checkbox">
                                                <input type="checkbox" name="counterServices" value="2" data-service="B">
                                                <span class="service-badge account">B</span>
                                                <span class="service-name">Account Services</span>
                                            </label>
                                        </div>
                                        <div class="service-assignment">
                                            <label class="service-checkbox">
                                                <input type="checkbox" name="counterServices" value="3" data-service="V">
                                                <span class="service-badge vip">V</span>
                                                <span class="service-name">VIP Services</span>
                                            </label>
                                        </div>
                                        <div class="service-assignment">
                                            <label class="service-checkbox">
                                                <input type="checkbox" name="counterServices" value="4" data-service="T">
                                                <span class="service-badge technical">T</span>
                                                <span class="service-name">Technical Support</span>
                                            </label>
                                        </div>
                                    </div>
                                </div>

                                <!-- Counter Settings -->
                                <div class="form-section">
                                    <h4 class="form-section-title">Counter Settings</h4>
                                    
                                    <div class="form-group">
                                        <label class="checkbox-label">
                                            <input type="checkbox" id="counterActive" name="counterActive" checked>
                                            <span class="checkmark"></span>
                                            Counter is active
                                        </label>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label class="checkbox-label">
                                            <input type="checkbox" id="counterAutoAssign" name="counterAutoAssign">
                                            <span class="checkmark"></span>
                                            Allow automatic agent assignment
                                        </label>
                                    </div>
                                </div>

                                <div class="validation-messages" id="counterValidationMessages"></div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="action-btn secondary" onclick="closeCounterModal()">
                                    Cancel
                                </button>
                                <button type="submit" class="action-btn primary">
                                    <span id="counterSaveButtonText">Save Counter</span>
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Confirm Delete Counter Modal -->
                <div id="deleteCounterModal" class="modal">
                    <div class="modal-content small">
                        <div class="modal-header">
                            <h3>Confirm Delete Counter</h3>
                            <button class="modal-close" onclick="closeDeleteCounterModal()">&times;</button>
                        </div>
                        <div class="modal-body">
                            <p>Are you sure you want to delete "<span id="deleteCounterName"></span>"?</p>
                            <p class="warning-text"> This will log out any active agent and cannot be undone.</p>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="action-btn secondary" onclick="closeDeleteCounterModal()">
                                Cancel
                            </button>
                            <button type="button" class="action-btn warning" onclick="confirmDeleteCounter()">
                                Delete Counter
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Agents Section -->
                <section id="agents-section" class="admin-section">
                    <div class="section-header">
                        <h2 class="section-title">Agents Management</h2>
                        <p class="section-description">Manage staff members and service assignments</p>
                    </div>

                    <!-- Agents Statistics Cards -->
                    <div class="agents-stats-grid">
                        <div class="agent-stat-card">
                            <div class="agent-stat-content">
                                <div class="agent-stat-value" id="totalAgents">5</div>
                                <div class="agent-stat-label">Total Agents</div>
                            </div>
                            <div class="agent-stat-icon"></div>
                        </div>
                        <div class="agent-stat-card">
                            <div class="agent-stat-content">
                                <div class="agent-stat-value" id="onlineAgents">3</div>
                                <div class="agent-stat-label">Online Now</div>
                            </div>
                            <div class="agent-stat-icon"></div>
                        </div>
                        <div class="agent-stat-card">
                            <div class="agent-stat-content">
                                <div class="agent-stat-value" id="topPerformer">John S.</div>
                                <div class="agent-stat-label">Top Performer</div>
                            </div>
                            <div class="agent-stat-icon"></div>
                        </div>
                        <div class="agent-stat-card">
                            <div class="agent-stat-content">
                                <div class="agent-stat-value" id="totalTicketsServed">47</div>
                                <div class="agent-stat-label">Tickets Served Today</div>
                            </div>
                            <div class="agent-stat-icon"></div>
                        </div>
                    </div>

                    <!-- Online Agents Quick View -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Currently Online</h3>
                            <div class="online-count">
                                <span class="online-indicator"></span>
                                <span id="liveOnlineCount">3 agents online</span>
                            </div>
                        </div>
                        <div class="online-agents-grid" id="onlineAgentsGrid">
                            <!-- Online agents will be loaded here -->
                            <div class="online-agent-loading">Loading online agents...</div>
                        </div>
                    </div>

                    <!-- Agents Management -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">All Agents</h3>
                            <div class="agents-header-actions">
                                <button class="action-btn primary" onclick="addAgent()">
                                     Add Agent
                                </button>
                                <div class="search-box">
                                    <input type="text" id="agentsSearch" placeholder="Search agents..." onkeyup="filterAgents()">
                                </div>
                            </div>
                        </div>

                        <div class="agents-table-container">
                            <table class="agents-table" id="agentsTable">
                                <thead>
                                    <tr>
                                        <th>Agent</th>
                                        <th>Username</th>
                                        <th>Status</th>
                                        <th>Assigned Services</th>
                                        <th>Current Counter</th>
                                        <th>Today's Performance</th>
                                        <th>Role</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="agentsTableBody">
                                    <tr class="loading-row">
                                        <td colspan="8" class="text-center">Loading agents...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Agent Performance Analytics -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Performance Analytics (Today)</h3>
                            <button class="refresh-btn" onclick="refreshAgentStats()"></button>
                        </div>
                        <div class="agent-performance-grid" id="agentPerformanceGrid">
                            <!-- Performance charts will be loaded here -->
                            <div class="performance-loading">Loading performance data...</div>
                        </div>
                    </div>
                </section>

                <!-- Add/Edit Agent Modal -->
                <div id="agentModal" class="modal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3 id="agentModalTitle">Add New Agent</h3>
                            <button class="modal-close" onclick="closeAgentModal()">&times;</button>
                        </div>
                        <form id="agentForm" onsubmit="saveAgent(event)">
                            <div class="modal-body">
                                <input type="hidden" id="agentId" name="agentId">
                                
                                <!-- Basic Information -->
                                <div class="form-section">
                                    <h4 class="form-section-title">Basic Information</h4>
                                    
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="agentName">Full Name *</label>
                                            <input type="text" id="agentName" name="agentName" required 
                                                   placeholder="e.g., John Smith">
                                        </div>
                                        <div class="form-group">
                                            <label for="agentUsername">Username *</label>
                                            <input type="text" id="agentUsername" name="agentUsername" required 
                                                   placeholder="e.g., jsmith" style="text-transform: lowercase;">
                                        </div>
                                    </div>

                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="agentEmail">Email</label>
                                            <input type="email" id="agentEmail" name="agentEmail" 
                                                   placeholder="john.smith@company.com">
                                        </div>
                                        <div class="form-group">
                                            <label for="agentRole">Role</label>
                                            <select id="agentRole" name="agentRole">
                                                <option value="agent">Agent</option>
                                                <option value="supervisor">Supervisor</option>
                                                <option value="admin">Admin</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>

                                <!-- Service Assignments -->
                                <div class="form-section">
                                    <h4 class="form-section-title">Service Assignments</h4>
                                    <p class="form-section-description">Select which services this agent can handle</p>
                                    
                                    <div class="service-assignments" id="serviceAssignments">
                                        <!-- Service checkboxes will be loaded here -->
                                        <div class="service-assignment">
                                            <label class="service-checkbox">
                                                <input type="checkbox" name="services" value="1" data-service="A">
                                                <span class="service-badge general">A</span>
                                                <span class="service-name">General Service</span>
                                                <select class="priority-select" name="priority_1">
                                                    <option value="1">Primary</option>
                                                    <option value="2">Secondary</option>
                                                </select>
                                            </label>
                                        </div>
                                        <div class="service-assignment">
                                            <label class="service-checkbox">
                                                <input type="checkbox" name="services" value="2" data-service="B">
                                                <span class="service-badge account">B</span>
                                                <span class="service-name">Account Services</span>
                                                <select class="priority-select" name="priority_2">
                                                    <option value="1">Primary</option>
                                                    <option value="2">Secondary</option>
                                                </select>
                                            </label>
                                        </div>
                                        <div class="service-assignment">
                                            <label class="service-checkbox">
                                                <input type="checkbox" name="services" value="3" data-service="V">
                                                <span class="service-badge vip">V</span>
                                                <span class="service-name">VIP Services</span>
                                                <select class="priority-select" name="priority_3">
                                                    <option value="1">Primary</option>
                                                    <option value="2">Secondary</option>
                                                </select>
                                            </label>
                                        </div>
                                        <div class="service-assignment">
                                            <label class="service-checkbox">
                                                <input type="checkbox" name="services" value="4" data-service="T">
                                                <span class="service-badge technical">T</span>
                                                <span class="service-name">Technical Support</span>
                                                <select class="priority-select" name="priority_4">
                                                    <option value="1">Primary</option>
                                                    <option value="2">Secondary</option>
                                                </select>
                                            </label>
                                        </div>
                                    </div>
                                </div>

                                <!-- Account Settings -->
                                <div class="form-section">
                                    <h4 class="form-section-title">Account Settings</h4>
                                    
                                    <div class="form-group">
                                        <label for="agentPassword">Password</label>
                                        <input type="password" id="agentPassword" name="agentPassword" 
                                               placeholder="Leave blank to keep current password">
                                        <small class="form-help">For new agents, a temporary password will be generated</small>
                                    </div>

                                    <div class="form-group">
                                        <label class="checkbox-label">
                                            <input type="checkbox" id="agentActive" name="agentActive" checked>
                                            <span class="checkmark"></span>
                                            Agent account is active
                                        </label>
                                    </div>
                                </div>

                                <div class="validation-messages" id="agentValidationMessages"></div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="action-btn secondary" onclick="closeAgentModal()">
                                    Cancel
                                </button>
                                <button type="submit" class="action-btn primary">
                                    <span id="agentSaveButtonText">Save Agent</span>
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Confirm Delete Agent Modal -->
                <div id="deleteAgentModal" class="modal">
                    <div class="modal-content small">
                        <div class="modal-header">
                            <h3>Confirm Delete Agent</h3>
                            <button class="modal-close" onclick="closeDeleteAgentModal()">&times;</button>
                        </div>
                        <div class="modal-body">
                            <p>Are you sure you want to delete agent "<span id="deleteAgentName"></span>"?</p>
                            <p class="warning-text"> This will remove the agent's access and cannot be undone.</p>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="action-btn secondary" onclick="closeDeleteAgentModal()">
                                Cancel
                            </button>
                            <button type="button" class="action-btn warning" onclick="confirmDeleteAgent()">
                                Delete Agent
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Settings Section -->
                <section id="settings-section" class="admin-section">
                    <div class="section-header">
                        <h2 class="section-title">System Settings</h2>
                        <p class="section-description">Configure system features and options</p>
                    </div>

                    <!-- Settings Statistics Cards -->
                    <div class="settings-stats-grid">
                        <div class="setting-stat-card">
                            <div class="setting-stat-content">
                                <div class="setting-stat-value" id="activeFeatures">12</div>
                                <div class="setting-stat-label">Active Features</div>
                            </div>
                            <div class="setting-stat-icon"></div>
                        </div>
                        <div class="setting-stat-card">
                            <div class="setting-stat-content">
                                <div class="setting-stat-value" id="lastModified">2 hrs ago</div>
                                <div class="setting-stat-label">Last Modified</div>
                            </div>
                            <div class="setting-stat-icon"></div>
                        </div>
                        <div class="setting-stat-card">
                            <div class="setting-stat-content">
                                <div class="setting-stat-value" id="systemHealth">Healthy</div>
                                <div class="setting-stat-label">System Status</div>
                            </div>
                            <div class="setting-stat-icon"></div>
                        </div>
                        <div class="setting-stat-card">
                            <div class="setting-stat-content">
                                <div class="setting-stat-value" id="configVersion">v2.4</div>
                                <div class="setting-stat-label">Config Version</div>
                            </div>
                            <div class="setting-stat-icon"></div>
                        </div>
                    </div>

                    <!-- Settings Categories -->
                    <div class="settings-categories">
                        <!-- Feature Flags -->
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Feature Flags</h3>
                                <div class="settings-header-actions">
                                    <button class="action-btn primary" onclick="saveAllSettings()">
                                         Save Changes
                                    </button>
                                    <button class="action-btn secondary" onclick="resetToDefaults()">
                                         Reset to Defaults
                                    </button>
                                </div>
                            </div>
                            <div class="feature-flags-grid">
                                <div class="feature-flag">
                                    <div class="feature-info">
                                        <div class="feature-name">Voice Announcements</div>
                                        <div class="feature-description">Enable text-to-speech for ticket calls</div>
                                    </div>
                                    <div class="feature-toggle">
                                        <label class="toggle-switch">
                                            <input type="checkbox" id="voiceEnabled" checked>
                                            <span class="toggle-slider"></span>
                                        </label>
                                    </div>
                                </div>
                                
                                <div class="feature-flag">
                                    <div class="feature-info">
                                        <div class="feature-name">Ticket Printing</div>
                                        <div class="feature-description">Allow customers to print physical tickets</div>
                                    </div>
                                    <div class="feature-toggle">
                                        <label class="toggle-switch">
                                            <input type="checkbox" id="printEnabled" checked>
                                            <span class="toggle-slider"></span>
                                        </label>
                                    </div>
                                </div>

                                <div class="feature-flag">
                                    <div class="feature-info">
                                        <div class="feature-name">Cherry Pick</div>
                                        <div class="feature-description">Allow agents to select specific tickets</div>
                                    </div>
                                    <div class="feature-toggle">
                                        <label class="toggle-switch">
                                            <input type="checkbox" id="cherryPickEnabled">
                                            <span class="toggle-slider"></span>
                                        </label>
                                    </div>
                                </div>

                                <div class="feature-flag">
                                    <div class="feature-info">
                                        <div class="feature-name">Park Tickets</div>
                                        <div class="feature-description">Allow agents to park tickets for later</div>
                                    </div>
                                    <div class="feature-toggle">
                                        <label class="toggle-switch">
                                            <input type="checkbox" id="parkEnabled">
                                            <span class="toggle-slider"></span>
                                        </label>
                                    </div>
                                </div>

                                <div class="feature-flag">
                                    <div class="feature-info">
                                        <div class="feature-name">Recycle Numbers</div>
                                        <div class="feature-description">Reuse ticket numbers when reaching limit</div>
                                    </div>
                                    <div class="feature-toggle">
                                        <label class="toggle-switch">
                                            <input type="checkbox" id="recycleEnabled" checked>
                                            <span class="toggle-slider"></span>
                                        </label>
                                    </div>
                                </div>

                                <div class="feature-flag">
                                    <div class="feature-info">
                                        <div class="feature-name">Auto Call Next</div>
                                        <div class="feature-description">Automatically call next ticket when one is completed</div>
                                    </div>
                                    <div class="feature-toggle">
                                        <label class="toggle-switch">
                                            <input type="checkbox" id="autoCallEnabled">
                                            <span class="toggle-slider"></span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- System Configuration -->
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">System Configuration</h3>
                            </div>
                            <div class="config-grid">
                                <div class="config-section">
                                    <h4 class="config-section-title">Queue Settings</h4>
                                    <div class="config-row">
                                        <div class="config-group">
                                            <label for="maxRecalls">Maximum Recalls</label>
                                            <input type="number" id="maxRecalls" value="3" min="1" max="10">
                                            <small class="config-help">How many times a ticket can be called before timeout</small>
                                        </div>
                                        <div class="config-group">
                                            <label for="recallInterval">Recall Interval (seconds)</label>
                                            <input type="number" id="recallInterval" value="30" min="10" max="300">
                                            <small class="config-help">Time between automatic recalls</small>
                                        </div>
                                    </div>
                                    <div class="config-row">
                                        <div class="config-group">
                                            <label for="ticketTimeout">Ticket Timeout (minutes)</label>
                                            <input type="number" id="ticketTimeout" value="15" min="5" max="60">
                                            <small class="config-help">How long before a called ticket expires</small>
                                        </div>
                                        <div class="config-group">
                                            <label for="maxWaitingTickets">Max Waiting Tickets</label>
                                            <input type="number" id="maxWaitingTickets" value="100" min="10" max="500">
                                            <small class="config-help">Maximum tickets allowed in queue</small>
                                        </div>
                                    </div>
                                </div>

                                <div class="config-section">
                                    <h4 class="config-section-title">Display Settings</h4>
                                    <div class="config-row">
                                        <div class="config-group">
                                            <label for="refreshInterval">Display Refresh (seconds)</label>
                                            <input type="number" id="refreshInterval" value="5" min="1" max="30">
                                            <small class="config-help">How often displays update automatically</small>
                                        </div>
                                        <div class="config-group">
                                            <label for="showWaitTime">Show Wait Times</label>
                                            <select id="showWaitTime">
                                                <option value="always">Always</option>
                                                <option value="over_5min">Over 5 minutes only</option>
                                                <option value="never">Never</option>
                                            </select>
                                            <small class="config-help">When to display estimated wait times</small>
                                        </div>
                                    </div>
                                </div>

                                <div class="config-section">
                                    <h4 class="config-section-title">Security Settings</h4>
                                    <div class="config-row">
                                        <div class="config-group">
                                            <label for="sessionTimeout">Session Timeout (minutes)</label>
                                            <input type="number" id="sessionTimeout" value="60" min="15" max="480">
                                            <small class="config-help">Agent auto-logout time</small>
                                        </div>
                                        <div class="config-group">
                                            <label for="adminSessionTimeout">Admin Session Timeout (minutes)</label>
                                            <input type="number" id="adminSessionTimeout" value="30" min="10" max="120">
                                            <small class="config-help">Admin panel auto-logout time</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Language & Localization -->
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Language & Localization</h3>
                            </div>
                            <div class="language-settings">
                                <div class="language-section">
                                    <h4 class="config-section-title">Available Languages</h4>
                                    <div class="language-grid">
                                        <div class="language-item">
                                            <label class="language-checkbox">
                                                <input type="checkbox" name="languages" value="en" checked>
                                                <span class="language-flag"></span>
                                                <span class="language-name">English</span>
                                                <span class="language-status">Default</span>
                                            </label>
                                        </div>
                                        <div class="language-item">
                                            <label class="language-checkbox">
                                                <input type="checkbox" name="languages" value="th" checked>
                                                <span class="language-flag"></span>
                                                <span class="language-name">Thai</span>
                                                <span class="language-status">Active</span>
                                            </label>
                                        </div>
                                        <div class="language-item">
                                            <label class="language-checkbox">
                                                <input type="checkbox" name="languages" value="hi" checked>
                                                <span class="language-flag"></span>
                                                <span class="language-name">Hindi</span>
                                                <span class="language-status">Active</span>
                                            </label>
                                        </div>
                                        <div class="language-item">
                                            <label class="language-checkbox">
                                                <input type="checkbox" name="languages" value="zh">
                                                <span class="language-flag"></span>
                                                <span class="language-name">Chinese</span>
                                                <span class="language-status">Available</span>
                                            </label>
                                        </div>
                                    </div>
                                </div>

                                <div class="language-section">
                                    <h4 class="config-section-title">Regional Settings</h4>
                                    <div class="config-row">
                                        <div class="config-group">
                                            <label for="defaultLanguage">Default Language</label>
                                            <select id="defaultLanguage">
                                                <option value="en">English</option>
                                                <option value="th">Thai</option>
                                                <option value="hi">Hindi</option>
                                            </select>
                                        </div>
                                        <div class="config-group">
                                            <label for="timeFormat">Time Format</label>
                                            <select id="timeFormat">
                                                <option value="12">12-hour (AM/PM)</option>
                                                <option value="24" selected>24-hour</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="config-row">
                                        <div class="config-group">
                                            <label for="timezone">Timezone</label>
                                            <select id="timezone">
                                                <option value="Asia/Bangkok" selected>Asia/Bangkok (GMT+7)</option>
                                                <option value="Asia/Kolkata">Asia/Kolkata (GMT+5:30)</option>
                                                <option value="UTC">UTC (GMT+0)</option>
                                            </select>
                                        </div>
                                        <div class="config-group">
                                            <label for="dateFormat">Date Format</label>
                                            <select id="dateFormat">
                                                <option value="DD/MM/YYYY" selected>DD/MM/YYYY</option>
                                                <option value="MM/DD/YYYY">MM/DD/YYYY</option>
                                                <option value="YYYY-MM-DD">YYYY-MM-DD</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Backup & Maintenance -->
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Backup & Maintenance</h3>
                            </div>
                            <div class="maintenance-grid">
                                <div class="maintenance-section">
                                    <h4 class="config-section-title">Automated Backups</h4>
                                    <div class="config-row">
                                        <div class="config-group">
                                            <label for="autoBackup">Enable Auto Backup</label>
                                            <label class="toggle-switch">
                                                <input type="checkbox" id="autoBackup" checked>
                                                <span class="toggle-slider"></span>
                                            </label>
                                        </div>
                                        <div class="config-group">
                                            <label for="backupFrequency">Backup Frequency</label>
                                            <select id="backupFrequency">
                                                <option value="daily" selected>Daily</option>
                                                <option value="weekly">Weekly</option>
                                                <option value="monthly">Monthly</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>

                                <div class="maintenance-section">
                                    <h4 class="config-section-title">Data Retention</h4>
                                    <div class="config-row">
                                        <div class="config-group">
                                            <label for="dataRetention">Keep Data For (days)</label>
                                            <input type="number" id="dataRetention" value="90" min="7" max="365">
                                            <small class="config-help">How long to keep completed tickets</small>
                                        </div>
                                        <div class="config-group">
                                            <label for="logRetention">Keep Logs For (days)</label>
                                            <input type="number" id="logRetention" value="30" min="7" max="90">
                                            <small class="config-help">How long to keep system logs</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Settings Change Log -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Recent Configuration Changes</h3>
                            <button class="refresh-btn" onclick="refreshSettingsLog()"></button>
                        </div>
                        <div class="settings-log" id="settingsLog">
                            <div class="log-item">
                                <div class="log-time">2 hours ago</div>
                                <div class="log-user">Admin User</div>
                                <div class="log-change">Enabled Voice Announcements</div>
                            </div>
                            <div class="log-item">
                                <div class="log-time">1 day ago</div>
                                <div class="log-user">System</div>
                                <div class="log-change">Auto backup completed successfully</div>
                            </div>
                            <div class="log-item">
                                <div class="log-time">3 days ago</div>
                                <div class="log-user">Admin User</div>
                                <div class="log-change">Updated max waiting tickets to 100</div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Reports Section -->
                <section id="reports-section" class="admin-section">
                    <div class="section-header">
                        <h2 class="section-title">Reports & Analytics</h2>
                        <p class="section-description">Business intelligence and performance metrics</p>
                    </div>

                    <!-- Reports Statistics Cards -->
                    <div class="reports-stats-grid">
                        <div class="report-stat-card">
                            <div class="report-stat-content">
                                <div class="report-stat-value" id="totalTicketsProcessed">1,247</div>
                                <div class="report-stat-label">Total Tickets (30 days)</div>
                            </div>
                            <div class="report-stat-icon"></div>
                        </div>
                        <div class="report-stat-card">
                            <div class="report-stat-content">
                                <div class="report-stat-value" id="avgWaitTime">4.2m</div>
                                <div class="report-stat-label">Avg Wait Time</div>
                            </div>
                            <div class="report-stat-icon"></div>
                        </div>
                        <div class="report-stat-card">
                            <div class="report-stat-content">
                                <div class="report-stat-value" id="peakHour">2-3 PM</div>
                                <div class="report-stat-label">Peak Hour</div>
                            </div>
                            <div class="report-stat-icon"></div>
                        </div>
                        <div class="report-stat-card">
                            <div class="report-stat-content">
                                <div class="report-stat-value" id="satisfactionRate">94%</div>
                                <div class="report-stat-label">Satisfaction Rate</div>
                            </div>
                            <div class="report-stat-icon"></div>
                        </div>
                    </div>

                    <!-- Report Controls -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Report Generation</h3>
                            <div class="reports-header-actions">
                                <div class="date-range-picker">
                                    <label for="reportDateFrom">From:</label>
                                    <input type="date" id="reportDateFrom" value="2025-06-01">
                                    <label for="reportDateTo">To:</label>
                                    <input type="date" id="reportDateTo" value="2025-06-28">
                                </div>
                                <button class="action-btn primary" onclick="generateReport()">
                                     Generate Report
                                </button>
                                <button class="action-btn secondary" onclick="exportReport()">
                                     Export PDF
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Performance Dashboard -->
                    <div class="reports-grid">
                        <!-- Daily Performance Chart -->
                        <div class="card chart-card">
                            <div class="card-header">
                                <h3 class="card-title">Daily Performance (Last 7 Days)</h3>
                                <div class="chart-controls">
                                    <select id="chartPeriod" onchange="updatePerformanceChart()">
                                        <option value="7">Last 7 Days</option>
                                        <option value="30">Last 30 Days</option>
                                        <option value="90">Last 90 Days</option>
                                    </select>
                                </div>
                            </div>
                            <div class="chart-container">
                                <canvas id="performanceChart" width="400" height="200"></canvas>
                            </div>
                        </div>

                        <!-- Service Distribution -->
                        <div class="card chart-card">
                            <div class="card-header">
                                <h3 class="card-title">Service Distribution</h3>
                            </div>
                            <div class="chart-container">
                                <canvas id="serviceChart" width="300" height="300"></canvas>
                            </div>
                            <div class="service-breakdown">
                                <div class="breakdown-item">
                                    <span class="service-badge general">A</span>
                                    <span class="service-name">General Service</span>
                                    <span class="service-percentage">45%</span>
                                </div>
                                <div class="breakdown-item">
                                    <span class="service-badge account">B</span>
                                    <span class="service-name">Account Services</span>
                                    <span class="service-percentage">25%</span>
                                </div>
                                <div class="breakdown-item">
                                    <span class="service-badge vip">V</span>
                                    <span class="service-name">VIP Services</span>
                                    <span class="service-percentage">15%</span>
                                </div>
                                <div class="breakdown-item">
                                    <span class="service-badge technical">T</span>
                                    <span class="service-name">Technical Support</span>
                                    <span class="service-percentage">15%</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Agent Performance Analysis -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Agent Performance Analysis</h3>
                            <div class="performance-period-selector">
                                <button class="period-btn active" onclick="setAgentPeriod('today')">Today</button>
                                <button class="period-btn" onclick="setAgentPeriod('week')">This Week</button>
                                <button class="period-btn" onclick="setAgentPeriod('month')">This Month</button>
                            </div>
                        </div>
                        <div class="agent-performance-table">
                            <table class="performance-table">
                                <thead>
                                    <tr>
                                        <th>Agent</th>
                                        <th>Tickets Handled</th>
                                        <th>Avg Service Time</th>
                                        <th>Customer Rating</th>
                                        <th>Efficiency Score</th>
                                        <th>Peak Performance</th>
                                    </tr>
                                </thead>
                                <tbody id="agentPerformanceTableBody">
                                    <tr>
                                        <td>
                                            <div class="agent-cell">
                                                <div class="agent-avatar" style="background: #8B5CF6;">JS</div>
                                                <span>John Smith</span>
                                            </div>
                                        </td>
                                        <td><strong>47</strong></td>
                                        <td>3.2m</td>
                                        <td>
                                            <div class="rating-display">
                                                <span>4.8</span>
                                                <div class="stars"></div>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="efficiency-bar">
                                                <div class="efficiency-fill" style="width: 96%"></div>
                                                <span>96%</span>
                                            </div>
                                        </td>
                                        <td>2-3 PM</td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <div class="agent-cell">
                                                <div class="agent-avatar" style="background: #10B981;">SC</div>
                                                <span>Sarah Chen</span>
                                            </div>
                                        </td>
                                        <td><strong>38</strong></td>
                                        <td>2.8m</td>
                                        <td>
                                            <div class="rating-display">
                                                <span>4.9</span>
                                                <div class="stars"></div>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="efficiency-bar">
                                                <div class="efficiency-fill" style="width: 98%"></div>
                                                <span>98%</span>
                                            </div>
                                        </td>
                                        <td>10-11 AM</td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <div class="agent-cell">
                                                <div class="agent-avatar" style="background: #F59E0B;">MJ</div>
                                                <span>Mike Johnson</span>
                                            </div>
                                        </td>
                                        <td><strong>23</strong></td>
                                        <td>4.1m</td>
                                        <td>
                                            <div class="rating-display">
                                                <span>4.6</span>
                                                <div class="stars"></div>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="efficiency-bar">
                                                <div class="efficiency-fill" style="width: 87%"></div>
                                                <span>87%</span>
                                            </div>
                                        </td>
                                        <td>3-4 PM</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Queue Analytics -->
                    <div class="reports-grid">
                        <!-- Wait Time Analysis -->
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Wait Time Analysis</h3>
                            </div>
                            <div class="wait-time-metrics">
                                <div class="metric-item">
                                    <div class="metric-label">Average Wait</div>
                                    <div class="metric-value good">4.2m</div>
                                    <div class="metric-trend up"> 8%</div>
                                </div>
                                <div class="metric-item">
                                    <div class="metric-label">Peak Wait</div>
                                    <div class="metric-value warning">12.5m</div>
                                    <div class="metric-trend down"> 15%</div>
                                </div>
                                <div class="metric-item">
                                    <div class="metric-label">Target Achievement</div>
                                    <div class="metric-value excellent">94%</div>
                                    <div class="metric-trend up"> 12%</div>
                                </div>
                            </div>
                            <div class="wait-time-breakdown">
                                <h4>Wait Time Distribution</h4>
                                <div class="wait-time-bars">
                                    <div class="wait-bar">
                                        <span class="wait-label">0-2 min</span>
                                        <div class="wait-progress">
                                            <div class="wait-fill excellent" style="width: 45%"></div>
                                        </div>
                                        <span class="wait-percentage">45%</span>
                                    </div>
                                    <div class="wait-bar">
                                        <span class="wait-label">2-5 min</span>
                                        <div class="wait-progress">
                                            <div class="wait-fill good" style="width: 35%"></div>
                                        </div>
                                        <span class="wait-percentage">35%</span>
                                    </div>
                                    <div class="wait-bar">
                                        <span class="wait-label">5-10 min</span>
                                        <div class="wait-progress">
                                            <div class="wait-fill warning" style="width: 15%"></div>
                                        </div>
                                        <span class="wait-percentage">15%</span>
                                    </div>
                                    <div class="wait-bar">
                                        <span class="wait-label">10+ min</span>
                                        <div class="wait-progress">
                                            <div class="wait-fill poor" style="width: 5%"></div>
                                        </div>
                                        <span class="wait-percentage">5%</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Peak Hours Analysis -->
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Peak Hours Analysis</h3>
                            </div>
                            <div class="peak-hours-grid">
                                <div class="hour-block low">
                                    <div class="hour-time">9 AM</div>
                                    <div class="hour-load">12%</div>
                                </div>
                                <div class="hour-block medium">
                                    <div class="hour-time">10 AM</div>
                                    <div class="hour-load">34%</div>
                                </div>
                                <div class="hour-block high">
                                    <div class="hour-time">11 AM</div>
                                    <div class="hour-load">78%</div>
                                </div>
                                <div class="hour-block medium">
                                    <div class="hour-time">12 PM</div>
                                    <div class="hour-load">56%</div>
                                </div>
                                <div class="hour-block low">
                                    <div class="hour-time">1 PM</div>
                                    <div class="hour-load">23%</div>
                                </div>
                                <div class="hour-block peak">
                                    <div class="hour-time">2 PM</div>
                                    <div class="hour-load">95%</div>
                                </div>
                                <div class="hour-block high">
                                    <div class="hour-time">3 PM</div>
                                    <div class="hour-load">82%</div>
                                </div>
                                <div class="hour-block medium">
                                    <div class="hour-time">4 PM</div>
                                    <div class="hour-load">45%</div>
                                </div>
                            </div>
                            <div class="peak-insights">
                                <div class="insight-item">
                                    <strong>Busiest Hour:</strong> 2-3 PM (95% capacity)
                                </div>
                                <div class="insight-item">
                                    <strong>Recommended Staffing:</strong> +2 agents during peak
                                </div>
                                <div class="insight-item">
                                    <strong>Quietest Period:</strong> 9-10 AM (12% capacity)
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Export Options -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Export & Sharing</h3>
                        </div>
                        <div class="export-options">
                            <div class="export-section">
                                <h4>Quick Reports</h4>
                                <div class="export-buttons">
                                    <button class="export-btn" onclick="exportDailyReport()">
                                         Daily Summary
                                    </button>
                                    <button class="export-btn" onclick="exportWeeklyReport()">
                                         Weekly Report
                                    </button>
                                    <button class="export-btn" onclick="exportMonthlyReport()">
                                         Monthly Analytics
                                    </button>
                                    <button class="export-btn" onclick="exportAgentReport()">
                                         Agent Performance
                                    </button>
                                </div>
                            </div>
                            <div class="export-section">
                                <h4>Custom Export</h4>
                                <div class="custom-export">
                                    <div class="export-controls">
                                        <select id="exportFormat">
                                            <option value="pdf">PDF Report</option>
                                            <option value="csv">CSV Data</option>
                                            <option value="excel">Excel Spreadsheet</option>
                                        </select>
                                        <select id="exportContent">
                                            <option value="full">Complete Report</option>
                                            <option value="summary">Executive Summary</option>
                                            <option value="agents">Agent Performance Only</option>
                                            <option value="services">Service Analytics Only</option>
                                        </select>
                                        <button class="action-btn primary" onclick="customExport()">
                                             Export
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Maintenance Section -->
                <section id="maintenance-section" class="admin-section">
                    <div class="section-header">
                        <h2 class="section-title">System Maintenance</h2>
                        <p class="section-description">System health monitoring and maintenance tools</p>
                    </div>

                    <!-- System Health Overview -->
                    <div class="maintenance-stats-grid">
                        <div class="maintenance-stat-card healthy">
                            <div class="maintenance-stat-content">
                                <div class="maintenance-stat-value" id="systemUptime">2d 14h 32m</div>
                                <div class="maintenance-stat-label">System Uptime</div>
                            </div>
                            <div class="maintenance-stat-icon"></div>
                        </div>
                        <div class="maintenance-stat-card good">
                            <div class="maintenance-stat-content">
                                <div class="maintenance-stat-value" id="memoryUsage">45%</div>
                                <div class="maintenance-stat-label">Memory Usage</div>
                            </div>
                            <div class="maintenance-stat-icon"></div>
                        </div>
                        <div class="maintenance-stat-card excellent">
                            <div class="maintenance-stat-content">
                                <div class="maintenance-stat-value" id="diskSpace">78%</div>
                                <div class="maintenance-stat-label">Disk Available</div>
                            </div>
                            <div class="maintenance-stat-icon"></div>
                        </div>
                        <div class="maintenance-stat-card healthy">
                            <div class="maintenance-stat-content">
                                <div class="maintenance-stat-value" id="responseTime">45ms</div>
                                <div class="maintenance-stat-label">Avg Response Time</div>
                            </div>
                            <div class="maintenance-stat-icon"></div>
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Quick Maintenance Actions</h3>
                        </div>
                        <div class="maintenance-quick-actions">
                            <button class="maintenance-action-btn backup" onclick="performBackup()">
                                <div class="action-icon"></div>
                                <div class="action-text">
                                    <div class="action-title">Create Backup</div>
                                    <div class="action-desc">Full system backup</div>
                                </div>
                            </button>
                            <button class="maintenance-action-btn optimize" onclick="optimizeDatabase()">
                                <div class="action-icon"></div>
                                <div class="action-text">
                                    <div class="action-title">Optimize Database</div>
                                    <div class="action-desc">Clean and optimize</div>
                                </div>
                            </button>
                            <button class="maintenance-action-btn logs" onclick="downloadLogs()">
                                <div class="action-icon"></div>
                                <div class="action-text">
                                    <div class="action-title">Download Logs</div>
                                    <div class="action-desc">Export system logs</div>
                                </div>
                            </button>
                            <button class="maintenance-action-btn restart" onclick="restartSystem()">
                                <div class="action-icon"></div>
                                <div class="action-text">
                                    <div class="action-title">Restart System</div>
                                    <div class="action-desc">Graceful restart</div>
                                </div>
                            </button>
                        </div>
                    </div>

                    <div class="maintenance-grid">
                        <!-- System Health Monitoring -->
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">System Health</h3>
                                <div class="health-status-indicator">
                                    <span class="status-dot healthy"></span>
                                    <span class="status-text">All Systems Operational</span>
                                </div>
                            </div>
                            <div class="health-metrics">
                                <div class="health-metric">
                                    <div class="metric-header">
                                        <span class="metric-name">CPU Usage</span>
                                        <span class="metric-value">23%</span>
                                    </div>
                                    <div class="metric-bar">
                                        <div class="metric-fill good" style="width: 23%"></div>
                                    </div>
                                </div>
                                <div class="health-metric">
                                    <div class="metric-header">
                                        <span class="metric-name">Memory Usage</span>
                                        <span class="metric-value">45%</span>
                                    </div>
                                    <div class="metric-bar">
                                        <div class="metric-fill good" style="width: 45%"></div>
                                    </div>
                                </div>
                                <div class="health-metric">
                                    <div class="metric-header">
                                        <span class="metric-name">Disk I/O</span>
                                        <span class="metric-value">12%</span>
                                    </div>
                                    <div class="metric-bar">
                                        <div class="metric-fill excellent" style="width: 12%"></div>
                                    </div>
                                </div>
                                <div class="health-metric">
                                    <div class="metric-header">
                                        <span class="metric-name">Network Load</span>
                                        <span class="metric-value">8%</span>
                                    </div>
                                    <div class="metric-bar">
                                        <div class="metric-fill excellent" style="width: 8%"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="health-details">
                                <div class="detail-item">
                                    <span class="detail-label">Database Connections:</span>
                                    <span class="detail-value">12/50</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Active Sessions:</span>
                                    <span class="detail-value">8</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Queue Size:</span>
                                    <span class="detail-value">23 tickets</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Last Backup:</span>
                                    <span class="detail-value">6 hours ago</span>
                                </div>
                            </div>
                        </div>

                        <!-- Database Management -->
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Database Management</h3>
                            </div>
                            <div class="database-stats">
                                <div class="db-stat">
                                    <div class="db-stat-label">Database Size</div>
                                    <div class="db-stat-value">24.7 MB</div>
                                </div>
                                <div class="db-stat">
                                    <div class="db-stat-label">Total Records</div>
                                    <div class="db-stat-value">1,247</div>
                                </div>
                                <div class="db-stat">
                                    <div class="db-stat-label">Last Optimized</div>
                                    <div class="db-stat-value">2 days ago</div>
                                </div>
                            </div>
                            <div class="database-actions">
                                <button class="db-action-btn" onclick="optimizeDatabase()">
                                     Optimize Database
                                </button>
                                <button class="db-action-btn" onclick="cleanupOldData()">
                                     Cleanup Old Data
                                </button>
                                <button class="db-action-btn" onclick="rebuildIndexes()">
                                     Rebuild Indexes
                                </button>
                                <button class="db-action-btn" onclick="analyzePerformance()">
                                     Analyze Performance
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Log Management -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">System Logs</h3>
                            <div class="log-controls">
                                <select id="logLevel" onchange="filterLogs()">
                                    <option value="all">All Levels</option>
                                    <option value="error">Errors</option>
                                    <option value="warning">Warnings</option>
                                    <option value="info">Info</option>
                                    <option value="debug">Debug</option>
                                </select>
                                <select id="logPeriod" onchange="filterLogs()">
                                    <option value="today">Today</option>
                                    <option value="week">This Week</option>
                                    <option value="month">This Month</option>
                                </select>
                                <button class="action-btn secondary" onclick="downloadLogs()">
                                     Download
                                </button>
                                <button class="action-btn primary" onclick="refreshLogs()">
                                     Refresh
                                </button>
                            </div>
                        </div>
                        <div class="log-viewer" id="logViewer">
                            <div class="log-entry error">
                                <div class="log-timestamp">2025-06-28 14:23:15</div>
                                <div class="log-level">ERROR</div>
                                <div class="log-message">Database connection timeout (resolved automatically)</div>
                            </div>
                            <div class="log-entry warning">
                                <div class="log-timestamp">2025-06-28 14:15:08</div>
                                <div class="log-level">WARN</div>
                                <div class="log-message">High memory usage detected: 89% (threshold: 85%)</div>
                            </div>
                            <div class="log-entry info">
                                <div class="log-timestamp">2025-06-28 14:10:22</div>
                                <div class="log-level">INFO</div>
                                <div class="log-message">Backup completed successfully: backup_2025-06-28_14-10.db</div>
                            </div>
                            <div class="log-entry info">
                                <div class="log-timestamp">2025-06-28 13:45:11</div>
                                <div class="log-level">INFO</div>
                                <div class="log-message">Agent 'Sarah Chen' logged in from 192.168.1.15</div>
                            </div>
                            <div class="log-entry debug">
                                <div class="log-timestamp">2025-06-28 13:30:45</div>
                                <div class="log-level">DEBUG</div>
                                <div class="log-message">Queue optimization completed: 15ms reduction in avg wait time</div>
                            </div>
                        </div>
                    </div>

                    <!-- Backup & Restore -->
                    <div class="maintenance-grid">
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Backup Management</h3>
                            </div>
                            <div class="backup-status">
                                <div class="backup-info">
                                    <div class="backup-item">
                                        <span class="backup-label">Last Backup:</span>
                                        <span class="backup-value">6 hours ago</span>
                                    </div>
                                    <div class="backup-item">
                                        <span class="backup-label">Backup Size:</span>
                                        <span class="backup-value">24.7 MB</span>
                                    </div>
                                    <div class="backup-item">
                                        <span class="backup-label">Auto Backup:</span>
                                        <span class="backup-value enabled">Enabled (Daily)</span>
                                    </div>
                                </div>
                                <button class="backup-now-btn" onclick="performBackup()">
                                     Backup Now
                                </button>
                            </div>
                            <div class="backup-history">
                                <h4>Recent Backups</h4>
                                <div class="backup-list">
                                    <div class="backup-file">
                                        <div class="backup-file-info">
                                            <div class="backup-filename">backup_2025-06-28_08-00.db</div>
                                            <div class="backup-date">Today, 8:00 AM (24.7 MB)</div>
                                        </div>
                                        <div class="backup-actions">
                                            <button class="backup-action download" onclick="downloadBackup('backup_2025-06-28_08-00.db')"></button>
                                            <button class="backup-action restore" onclick="restoreBackup('backup_2025-06-28_08-00.db')"></button>
                                        </div>
                                    </div>
                                    <div class="backup-file">
                                        <div class="backup-file-info">
                                            <div class="backup-filename">backup_2025-06-27_08-00.db</div>
                                            <div class="backup-date">Yesterday, 8:00 AM (23.1 MB)</div>
                                        </div>
                                        <div class="backup-actions">
                                            <button class="backup-action download" onclick="downloadBackup('backup_2025-06-27_08-00.db')"></button>
                                            <button class="backup-action restore" onclick="restoreBackup('backup_2025-06-27_08-00.db')"></button>
                                        </div>
                                    </div>
                                    <div class="backup-file">
                                        <div class="backup-file-info">
                                            <div class="backup-filename">backup_2025-06-26_08-00.db</div>
                                            <div class="backup-date">2 days ago, 8:00 AM (22.4 MB)</div>
                                        </div>
                                        <div class="backup-actions">
                                            <button class="backup-action download" onclick="downloadBackup('backup_2025-06-26_08-00.db')"></button>
                                            <button class="backup-action restore" onclick="restoreBackup('backup_2025-06-26_08-00.db')"></button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Performance Monitoring -->
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Performance Monitoring</h3>
                            </div>
                            <div class="performance-overview">
                                <div class="perf-metric">
                                    <div class="perf-label">Response Time</div>
                                    <div class="perf-value excellent">45ms</div>
                                    <div class="perf-trend up"> 12%</div>
                                </div>
                                <div class="perf-metric">
                                    <div class="perf-label">Throughput</div>
                                    <div class="perf-value good">156 req/min</div>
                                    <div class="perf-trend up"> 8%</div>
                                </div>
                                <div class="perf-metric">
                                    <div class="perf-label">Error Rate</div>
                                    <div class="perf-value excellent">0.02%</div>
                                    <div class="perf-trend down"> 45%</div>
                                </div>
                            </div>
                            <div class="performance-actions">
                                <button class="perf-action-btn" onclick="runPerformanceTest()">
                                     Run Performance Test
                                </button>
                                <button class="perf-action-btn" onclick="generatePerformanceReport()">
                                     Generate Report
                                </button>
                                <button class="perf-action-btn" onclick="optimizePerformance()">
                                     Optimize Performance
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- System Diagnostics -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">System Diagnostics</h3>
                            <button class="action-btn primary" onclick="runDiagnostics()">
                                 Run Full Diagnostics
                            </button>
                        </div>
                        <div class="diagnostics-grid">
                            <div class="diagnostic-test">
                                <div class="test-header">
                                    <span class="test-name">Database Connection</span>
                                    <span class="test-status passed"> PASSED</span>
                                </div>
                                <div class="test-details">Connected in 12ms</div>
                            </div>
                            <div class="diagnostic-test">
                                <div class="test-header">
                                    <span class="test-name">File System Access</span>
                                    <span class="test-status passed"> PASSED</span>
                                </div>
                                <div class="test-details">Read/Write permissions verified</div>
                            </div>
                            <div class="diagnostic-test">
                                <div class="test-header">
                                    <span class="test-name">Socket.IO Connection</span>
                                    <span class="test-status passed"> PASSED</span>
                                </div>
                                <div class="test-details">Real-time communication active</div>
                            </div>
                            <div class="diagnostic-test">
                                <div class="test-header">
                                    <span class="test-name">Memory Allocation</span>
                                    <span class="test-status warning"> WARNING</span>
                                </div>
                                <div class="test-details">Memory usage at 89% (consider cleanup)</div>
                            </div>
                            <div class="diagnostic-test">
                                <div class="test-header">
                                    <span class="test-name">API Endpoints</span>
                                    <span class="test-status passed"> PASSED</span>
                                </div>
                                <div class="test-details">All endpoints responding (avg: 45ms)</div>
                            </div>
                            <div class="diagnostic-test">
                                <div class="test-header">
                                    <span class="test-name">Backup System</span>
                                    <span class="test-status passed"> PASSED</span>
                                </div>
                                <div class="test-details">Last backup: 6 hours ago (successful)</div>
                            </div>
                        </div>
                    </div>
                </section>
            </main>
        </div>
    </div>

    <script>
        // Admin Panel JavaScript
        class AdminPanel {
            constructor() {
                this.apiBase = `${window.location.protocol}//${window.location.host}/api`;
                this.token = localStorage.getItem('admin_token');
                this.currentSection = 'dashboard';
                
                this.initializeEventListeners();
                
                // Check if already logged in
                if (this.token) {
                    this.verifyToken();
                } else {
                    this.showLogin();
                }
            }

            initializeEventListeners() {
                // Login form
                document.getElementById('loginForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.handleLogin();
                });

                // Logout button
                document.getElementById('logoutButton').addEventListener('click', () => {
                    this.handleLogout();
                });

                // Navigation
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.addEventListener('click', (e) => {
                        e.preventDefault();
                        const section = item.dataset.section;
                        this.showSection(section);
                    });
                });
            }

            async handleLogin() {
                const password = document.getElementById('password').value;
                const loginButton = document.getElementById('loginButton');
                const errorDiv = document.getElementById('loginError');

                loginButton.disabled = true;
                loginButton.textContent = 'Signing in...';
                errorDiv.classList.add('hidden');

                try {
                    const response = await fetch(`${this.apiBase}/admin/login`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ password })
                    });

                    const data = await response.json();

                    if (response.ok && data.token) {
                        this.token = data.token;
                        localStorage.setItem('admin_token', this.token);
                        this.showAdminPanel();
                    } else {
                        errorDiv.classList.remove('hidden');
                        document.getElementById('password').value = '';
                    }
                } catch (error) {
                    console.error('Login error:', error);
                    errorDiv.textContent = 'Connection error. Please try again.';
                    errorDiv.classList.remove('hidden');
                } finally {
                    loginButton.disabled = false;
                    loginButton.textContent = 'Sign In';
                }
            }

            async verifyToken() {
                try {
                    const response = await fetch(`${this.apiBase}/admin/verify`, {
                        headers: {
                            'Authorization': `Bearer ${this.token}`
                        }
                    });

                    if (response.ok) {
                        this.showAdminPanel();
                    } else {
                        this.handleLogout();
                    }
                } catch (error) {
                    console.error('Token verification error:', error);
                    this.handleLogout();
                }
            }

            handleLogout() {
                this.token = null;
                localStorage.removeItem('admin_token');
                this.showLogin();
            }

            showLogin() {
                document.getElementById('loginScreen').style.display = 'flex';
                document.getElementById('adminLayout').style.display = 'none';
                document.getElementById('password').focus();
            }

            showAdminPanel() {
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('adminLayout').style.display = 'block';
                this.showSection(this.currentSection);
            }

            showSection(sectionName) {
                // Update navigation
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.classList.remove('active');
                });
                document.querySelector(`[data-section="${sectionName}"]`).classList.add('active');

                // Update content
                document.querySelectorAll('.admin-section').forEach(section => {
                    section.classList.remove('active');
                });
                document.getElementById(`${sectionName}-section`).classList.add('active');

                this.currentSection = sectionName;
                
                // Update URL hash
                window.location.hash = sectionName;

                // Load section-specific data
                this.loadSectionData(sectionName);
            }

            async loadSectionData(sectionName) {
                // Section-specific data loading
                console.log(`Loading data for section: ${sectionName}`);
                
                switch(sectionName) {
                    case 'dashboard':
                        await this.loadDashboardData();
                        break;
                    case 'services':
                        await this.loadServicesData();
                        break;
                    case 'agents':
                        await this.loadAgentsData();
                        break;
                    case 'counters':
                        await this.loadCountersData();
                        break;
                    case 'settings':
                        await this.loadSettingsData();
                        break;
                    case 'reports':
                        await this.loadReportsData();
                        break;
                    case 'maintenance':
                        await this.loadMaintenanceData();
                        break;
                    default:
                        console.log(`No specific loader for ${sectionName}`);
                }
            }

            async loadDashboardData() {
                try {
                    // Load all dashboard data in parallel
                    const [statsData, activityData, queueData, healthData] = await Promise.all([
                        this.loadTodayStats(),
                        this.loadRecentActivity(),
                        this.loadQueueStatus(),
                        this.loadSystemHealth()
                    ]);

                    this.updateStatsCards(statsData);
                    this.updateActivityFeed(activityData);
                    this.updateQueueStatus(queueData);
                    this.updateSystemHealth(healthData);

                    // Setup real-time updates
                    this.setupDashboardRealtime();

                } catch (error) {
                    console.error('Error loading dashboard data:', error);
                }
            }

            async loadTodayStats() {
                try {
                    // Get today's tickets
                    const today = new Date().toISOString().split('T')[0];
                    
                    // This would need the actual API endpoint for stats
                    // For now, let's simulate with available APIs
                    const response = await this.apiCall('/admin/settings');
                    
                    // Mock data for demonstration
                    return {
                        ticketsToday: 47,
                        activeQueues: 4,
                        agentsOnline: 2,
                        avgWaitTime: 4.2
                    };
                } catch (error) {
                    console.error('Error loading stats:', error);
                    return {
                        ticketsToday: '--',
                        activeQueues: '--', 
                        agentsOnline: '--',
                        avgWaitTime: '--'
                    };
                }
            }

            async loadRecentActivity() {
                try {
                    // This would get recent events from the events table
                    // For now, simulate activity
                    const now = new Date();
                    return [
                        {
                            time: this.formatTime(new Date(now - 2 * 60000)),
                            text: 'New ticket A045 issued (General Service)',
                            type: 'ticket-created'
                        },
                        {
                            time: this.formatTime(new Date(now - 5 * 60000)),
                            text: 'Agent John called ticket A044',
                            type: 'ticket-called'
                        },
                        {
                            time: this.formatTime(new Date(now - 8 * 60000)),
                            text: 'Ticket B023 completed at Counter 2',
                            type: 'ticket-completed'
                        },
                        {
                            time: this.formatTime(new Date(now - 12 * 60000)),
                            text: 'Agent Sarah logged in',
                            type: 'agent-login'
                        }
                    ];
                } catch (error) {
                    console.error('Error loading activity:', error);
                    return [];
                }
            }

            async loadQueueStatus() {
                try {
                    // This would get actual queue counts per service
                    return [
                        { service: 'General Service', code: 'A', waiting: 5, class: 'general' },
                        { service: 'Account Services', code: 'B', waiting: 3, class: 'account' },
                        { service: 'VIP Services', code: 'V', waiting: 1, class: 'vip' },
                        { service: 'Technical Support', code: 'T', waiting: 2, class: 'technical' }
                    ];
                } catch (error) {
                    console.error('Error loading queue status:', error);
                    return [];
                }
            }

            async loadSystemHealth() {
                try {
                    // Check system health
                    const healthResponse = await fetch(`${this.apiBase}/health`);
                    const isHealthy = healthResponse.ok;
                    
                    return {
                        database: isHealthy ? 'online' : 'offline',
                        socket: 'online', // We're connected if we got here
                        memory: '45%',
                        uptime: '2d 14h 32m'
                    };
                } catch (error) {
                    console.error('Error checking system health:', error);
                    return {
                        database: 'offline',
                        socket: 'offline',
                        memory: '--',
                        uptime: '--'
                    };
                }
            }

            updateStatsCards(stats) {
                document.getElementById('ticketsToday').textContent = stats.ticketsToday;
                document.getElementById('activeQueues').textContent = stats.activeQueues;
                document.getElementById('agentsOnline').textContent = stats.agentsOnline;
                document.getElementById('avgWait').textContent = stats.avgWaitTime + 'm';

                // Update trends
                document.getElementById('ticketsTrend').textContent = '+12';
                document.getElementById('queuesTrend').textContent = '11 waiting';
                document.getElementById('agentsTrend').textContent = `${stats.agentsOnline}/5`;
                document.getElementById('waitTrend').textContent = 'minutes';
            }

            updateActivityFeed(activities) {
                const feed = document.getElementById('activityFeed');
                feed.innerHTML = '';

                activities.forEach(activity => {
                    const item = document.createElement('div');
                    item.className = 'activity-item';
                    item.innerHTML = `
                        <span class="activity-time">${activity.time}</span>
                        <span class="activity-text">${activity.text}</span>
                    `;
                    feed.appendChild(item);
                });

                if (activities.length === 0) {
                    feed.innerHTML = '<div class="activity-item loading">No recent activity</div>';
                }
            }

            updateQueueStatus(queues) {
                const queueList = document.getElementById('queueList');
                queueList.innerHTML = '';

                queues.forEach(queue => {
                    const item = document.createElement('div');
                    item.className = 'queue-item';
                    item.innerHTML = `
                        <span class="service-badge ${queue.class}">
                            ${queue.code} - ${queue.service}
                        </span>
                        <span class="queue-count">${queue.waiting} waiting</span>
                    `;
                    queueList.appendChild(item);
                });

                if (queues.length === 0) {
                    queueList.innerHTML = '<div class="queue-item loading">No active queues</div>';
                }
            }

            updateSystemHealth(health) {
                document.getElementById('dbStatus').className = `health-status ${health.database}`;
                document.getElementById('socketStatus').className = `health-status ${health.socket}`;
                document.getElementById('memoryUsage').textContent = health.memory;
                document.getElementById('uptime').textContent = health.uptime;
            }

            setupDashboardRealtime() {
                // Setup Socket.IO for real-time dashboard updates
                if (typeof io !== 'undefined') {
                    const socket = io('/admin');
                    
                    socket.on('ticket-created', (data) => {
                        this.addActivityItem(data.time, `New ticket ${data.ticket.number} issued (${data.service.name})`);
                        this.updateStatsFromEvent('ticket-created');
                    });

                    socket.on('ticket-called', (data) => {
                        this.addActivityItem(data.time, `Agent ${data.agent.name} called ticket ${data.ticket.number}`);
                    });

                    socket.on('ticket-completed', (data) => {
                        this.addActivityItem(data.time, `Ticket ${data.ticket.number} completed at ${data.counter.name}`);
                        this.updateStatsFromEvent('ticket-completed');
                    });

                    socket.on('queue-updated', (data) => {
                        this.refreshQueueStatus();
                    });
                }

                // Auto-refresh dashboard every 30 seconds
                setInterval(() => {
                    if (this.currentSection === 'dashboard') {
                        this.refreshDashboardStats();
                    }
                }, 30000);
            }

            addActivityItem(time, text) {
                const feed = document.getElementById('activityFeed');
                const item = document.createElement('div');
                item.className = 'activity-item';
                item.innerHTML = `
                    <span class="activity-time">${this.formatTime(new Date(time))}</span>
                    <span class="activity-text">${text}</span>
                `;
                feed.insertBefore(item, feed.firstChild);

                // Keep only last 10 items
                while (feed.children.length > 10) {
                    feed.removeChild(feed.lastChild);
                }
            }

            updateStatsFromEvent(eventType) {
                // Update relevant stats when events occur
                const ticketsElement = document.getElementById('ticketsToday');
                if (eventType === 'ticket-created') {
                    const current = parseInt(ticketsElement.textContent) || 0;
                    ticketsElement.textContent = current + 1;
                }
            }

            async refreshDashboardStats() {
                const stats = await this.loadTodayStats();
                this.updateStatsCards(stats);
            }

            async refreshQueueStatus() {
                const queues = await this.loadQueueStatus();
                this.updateQueueStatus(queues);
            }

            formatTime(date) {
                return date.toLocaleTimeString('en-US', { 
                    hour12: false, 
                    hour: '2-digit', 
                    minute: '2-digit' 
                });
            }

            async loadServicesData() {
                try {
                    console.log('Loading services data...');

                    const services = await this.loadServicesList();
                    this.servicesData = services;
                    this.renderAgentServiceOptions(services);

                    const statsData = this.computeServicesStats(services);
                    const performanceData = this.computeServicePerformance(services);

                    this.updateServicesTable(services);
                    this.updateServicesStats(statsData);
                    this.updateServicePerformance(performanceData);

                } catch (error) {
                    console.error('Error loading services data:', error);
                    this.showError('Error loading services data. Please try again.');
                }
            }

            async loadServicesList() {
                try {
                    const response = await this.apiCall('/admin/services');
                    if (!response.ok) {
                        throw new Error('Failed to fetch services');
                    }

                    const data = await response.json();
                    const services = Array.isArray(data.services) ? data.services : [];
                    return services.map(service => ({
                        ...service,
                        is_active: service.is_active === true || service.is_active === 1 || service.is_active === 'true'
                    }));
                } catch (error) {
                    console.error('Error loading services list:', error);
                    return [];
                }
            }

            computeServicesStats(services = []) {
                const totalServices = services.length;
                const activeServices = services.filter(s => s.is_active).length;
                const totalTicketsToday = services.reduce((sum, s) => sum + (s.tickets_today || 0), 0);
                const avgServiceTime = services.length
                    ? services.reduce((sum, s) => sum + (s.avg_wait_today || 0), 0) / services.length
                    : 0;

                return {
                    totalServices,
                    activeServices,
                    totalTicketsToday,
                    avgServiceTime: avgServiceTime.toFixed(1)
                };
            }

            computeServicePerformance(services = []) {
                return services.map(service => ({
                    id: service.id,
                    name: service.name,
                    prefix: service.prefix,
                    tickets_today: service.tickets_today || 0,
                    avg_wait: service.avg_wait_today || 0,
                    efficiency: this.calculateEfficiency(service.tickets_today, service.avg_wait_today)
                }));
            }

            renderAgentServiceOptions(services = []) {
                const container = document.getElementById('serviceAssignments');
                if (!container) return;

                if (!Array.isArray(services) || services.length === 0) {
                    container.innerHTML = '<div class="service-assignment">No services available</div>';
                    return;
                }

                container.innerHTML = services
                    .map(service => {
                        const prefix = (service.prefix || '').toString().trim() || '?';
                        const prefixKey = prefix.toUpperCase();
                        const badgeMap = {
                            A: 'general',
                            B: 'account',
                            V: 'vip',
                            T: 'technical'
                        };
                        const badgeClass = badgeMap[prefixKey] || 'general';
                        const serviceName = service.name || `Service ${service.id}`;
                        return `
                            <div class="service-assignment">
                                <label class="service-checkbox">
                                    <input type="checkbox" name="services" value="${service.id}" data-service="${prefix}">
                                    <span class="service-badge ${badgeClass}">${prefix}</span>
                                    <span class="service-name">${serviceName}</span>
                                    <select class="priority-select" name="priority_${service.id}">
                                        <option value="1">Primary</option>
                                        <option value="2">Secondary</option>
                                    </select>
                                </label>
                            </div>
                        `;
                    })
                    .join('');
            }

            calculateEfficiency(tickets, avgWait) {
                if (!tickets || !avgWait) return 100;
                // Simple efficiency calculation: more tickets + less wait = higher efficiency
                const efficiency = Math.max(0, 100 - (avgWait * 5));
                return Math.min(100, efficiency);
            }

            updateServicesTable(services) {
                const tbody = document.getElementById('servicesTableBody');
                tbody.innerHTML = '';

                if (!services || services.length === 0) {
                    tbody.innerHTML = '<tr class="loading-row"><td colspan="8" class="text-center">No services found</td></tr>';
                    return;
                }

                services.forEach(service => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>
                            <div style="font-weight: 600; color: #1F2937;">${service.name}</div>
                            <div style="font-size: 12px; color: #6B7280;">${service.description || 'No description'}</div>
                        </td>
                        <td>
                            <span class="service-prefix">${service.prefix}</span>
                        </td>
                        <td>${service.range_start} - ${service.range_end}</td>
                        <td>
                            <span style="font-weight: 600;">${service.prefix}${String(service.current_number).padStart(3, '0')}</span>
                        </td>
                        <td>
                            <span class="service-status ${service.is_active ? 'active' : 'inactive'}">
                                ${service.is_active ? '' : ''} ${service.is_active ? 'Active' : 'Inactive'}
                            </span>
                        </td>
                        <td style="font-weight: 600; color: #10B981;">${service.tickets_today || 0}</td>
                        <td>${service.avg_wait_today ? service.avg_wait_today + 'm' : '--'}</td>
                        <td>
                            <div class="service-actions">
                                <button class="service-action-btn edit" onclick="editService(${service.id})" title="Edit Service">
                                    
                                </button>
                                <button class="service-action-btn toggle" onclick="toggleService(${service.id})" title="${service.is_active ? 'Deactivate' : 'Activate'} Service">
                                    ${service.is_active ? '' : ''}
                                </button>
                                <button class="service-action-btn delete" onclick="deleteService(${service.id}, '${service.name}')" title="Delete Service">
                                    
                                </button>
                            </div>
                        </td>
                    `;
                    tbody.appendChild(row);
                });

                // Store services data for filtering
                this.servicesData = services;
            }

            updateServicesStats(stats) {
                document.getElementById('totalServices').textContent = stats.totalServices;
                document.getElementById('activeServices').textContent = stats.activeServices;
                document.getElementById('totalTicketsToday').textContent = stats.totalTicketsToday;
                document.getElementById('avgServiceTime').textContent = stats.avgServiceTime + 'm';
            }

            updateServicePerformance(performance) {
                const grid = document.getElementById('servicePerformanceGrid');
                grid.innerHTML = '';

                if (!performance || performance.length === 0) {
                    grid.innerHTML = '<div class="performance-loading">No performance data available</div>';
                    return;
                }

                performance.forEach(service => {
                    const item = document.createElement('div');
                    item.className = 'performance-item';
                    item.innerHTML = `
                        <div class="performance-service-name">${service.prefix} - ${service.name}</div>
                        <div style="font-size: 24px; font-weight: 700; color: #10B981; margin: 8px 0;">
                            ${service.tickets_today}
                        </div>
                        <div style="font-size: 12px; color: #6B7280;">tickets today</div>
                        <div class="performance-stats">
                            <span>Avg Wait: ${service.avg_wait}m</span>
                            <span>Efficiency: ${service.efficiency}%</span>
                        </div>
                    `;
                    grid.appendChild(item);
                });
            }

            filterServices() {
                const searchTerm = document.getElementById('servicesSearch').value.toLowerCase();
                const tbody = document.getElementById('servicesTableBody');
                const rows = tbody.querySelectorAll('tr:not(.loading-row)');

                rows.forEach(row => {
                    const text = row.textContent.toLowerCase();
                    row.style.display = text.includes(searchTerm) ? '' : 'none';
                });
            }

            showError(message) {
                // Simple error handling - could be enhanced with toast notifications
                console.error(message);
                alert(message);
            }

            showSuccess(message) {
                // Simple success handling - could be enhanced with toast notifications
                console.log(message);
                alert(message);
            }

            validateServiceForm(formData) {
                const errors = [];

                // Required field validation
                if (!formData.serviceName.trim()) {
                    errors.push('Service name is required');
                }

                if (!formData.servicePrefix.trim()) {
                    errors.push('Service prefix is required');
                }

                if (!formData.rangeStart || formData.rangeStart < 1) {
                    errors.push('Range start must be a positive number');
                }

                if (!formData.rangeEnd || formData.rangeEnd < 1) {
                    errors.push('Range end must be a positive number');
                }

                if (formData.rangeStart >= formData.rangeEnd) {
                    errors.push('Range end must be greater than range start');
                }

                // Business logic validation
                if (formData.servicePrefix.length > 3) {
                    errors.push('Service prefix must be 3 characters or less');
                }

                // Check for duplicate prefix (would need to check against existing services)
                const existingPrefixes = this.servicesData?.map(s => s.prefix.toLowerCase()) || [];
                const currentId = formData.serviceId;
                const currentService = this.servicesData?.find(s => s.id == currentId);
                
                if (existingPrefixes.includes(formData.servicePrefix.toLowerCase()) && 
                    (!currentService || currentService.prefix.toLowerCase() !== formData.servicePrefix.toLowerCase())) {
                    errors.push('Service prefix already exists');
                }

                return errors;
            }

            async saveServiceData(serviceData) {
                try {
                    // This would call the actual API
                    // POST /api/admin/services (for new) or PUT /api/admin/services/:id (for edit)
                    
                    const isEdit = serviceData.serviceId;
                    const method = isEdit ? 'PUT' : 'POST';
                    const url = isEdit ? `/admin/services/${serviceData.serviceId}` : '/admin/services';

                    const response = await this.apiCall(url, {
                        method,
                        body: JSON.stringify({
                            name: serviceData.serviceName,
                            prefix: serviceData.servicePrefix,
                            description: serviceData.serviceDescription,
                            range_start: parseInt(serviceData.rangeStart),
                            range_end: parseInt(serviceData.rangeEnd),
                            current_number: parseInt(serviceData.currentNumber) || 0,
                            estimated_service_time: parseInt(serviceData.estimatedServiceTime) || 300,
                            is_active: serviceData.isActive
                        })
                    });

                    if (response.ok) {
                        this.showSuccess(isEdit ? 'Service updated successfully!' : 'Service created successfully!');
                        await this.loadServicesData(); // Refresh the data
                        return true;
                    } else {
                        const error = await response.json();
                        throw new Error(error.message || 'Failed to save service');
                    }
                } catch (error) {
                    console.error('Error saving service:', error);
                    this.showError('Error saving service: ' + error.message);
                    return false;
                }
            }

            async deleteServiceData(serviceId) {
                try {
                    const response = await this.apiCall(`/admin/services/${serviceId}`, {
                        method: 'DELETE'
                    });

                    if (response.ok) {
                        this.showSuccess('Service deleted successfully!');
                        await this.loadServicesData(); // Refresh the data
                        return true;
                    } else {
                        const error = await response.json();
                        throw new Error(error.message || 'Failed to delete service');
                    }
                } catch (error) {
                    console.error('Error deleting service:', error);
                    this.showError('Error deleting service: ' + error.message);
                    return false;
                }
            }

            async toggleServiceStatus(serviceId) {
                try {
                    const service = this.servicesData?.find(s => s.id === serviceId);
                    if (!service) {
                        throw new Error('Service not found');
                    }

                    const response = await this.apiCall(`/admin/services/${serviceId}`, {
                        method: 'PUT',
                        body: JSON.stringify({
                            ...service,
                            is_active: !service.is_active
                        })
                    });

                    if (response.ok) {
                        const action = service.is_active ? 'deactivated' : 'activated';
                        this.showSuccess(`Service ${action} successfully!`);
                        await this.loadServicesData(); // Refresh the data
                        return true;
                    } else {
                        const error = await response.json();
                        throw new Error(error.message || 'Failed to toggle service status');
                    }
                } catch (error) {
                    console.error('Error toggling service status:', error);
                    this.showError('Error updating service status: ' + error.message);
                    return false;
                }
            }

            async loadAgentsData() {
                try {
                    console.log('Loading agents data...');

                    const agents = await this.loadAgentsList();
                    this.agentsData = agents;

                    const statsData = this.computeAgentsStats(agents);
                    const performanceData = this.computeAgentPerformance(agents);
                    const onlineData = this.computeOnlineAgents(agents);

                    this.updateAgentsTable(agents);
                    this.updateAgentsStats(statsData);
                    this.updateAgentPerformance(performanceData);
                    this.updateOnlineAgents(onlineData);

                } catch (error) {
                    console.error('Error loading agents data:', error);
                    this.showError('Error loading agents data. Please try again.');
                }
            }

            async loadAgentsList() {
                try {
                    const response = await this.apiCall('/admin/agents');
                    if (!response.ok) {
                        throw new Error('Failed to fetch agents');
                    }

                    const data = await response.json();
                    const agents = Array.isArray(data.agents) ? data.agents : [];

                    return agents.map(agent => ({
                        ...agent,
                        role: agent.role || 'agent',
                        status: agent.status || 'offline',
                        current_counter: agent.current_counter || null,
                        services: (agent.services || []).map(service => ({
                            service_id: service.service_id,
                            service_name: service.service_name,
                            prefix: service.prefix,
                            priority: service.priority
                        })),
                        performance: agent.performance || {
                            tickets_today: 0,
                            avg_service_time: 0,
                            efficiency: 100
                        }
                    }));
                } catch (error) {
                    console.error('Error loading agents list:', error);
                    return [];
                }
            }

            computeAgentsStats(agents = []) {
                if (!agents.length) {
                    return {
                        totalAgents: 0,
                        onlineAgents: 0,
                        topPerformer: '',
                        totalTicketsServed: 0
                    };
                }

                const onlineAgents = agents.filter(agent => agent.status === 'online');
                const totalTicketsServed = agents.reduce(
                    (sum, agent) => sum + (agent.performance?.tickets_today || 0),
                    0
                );

                const topPerformerAgent = [...agents]
                    .sort((a, b) => (b.performance?.tickets_today || 0) - (a.performance?.tickets_today || 0))[0];

                return {
                    totalAgents: agents.length,
                    onlineAgents: onlineAgents.length,
                    topPerformer: topPerformerAgent ? topPerformerAgent.name : '',
                    totalTicketsServed
                };
            }

            computeAgentPerformance(agents = []) {
                return [...agents]
                    .map(agent => ({
                        id: agent.id,
                        name: agent.name,
                        status: agent.status,
                        performance: agent.performance || {
                            tickets_today: 0,
                            avg_service_time: 0,
                            efficiency: 100
                        },
                        services: agent.services || []
                    }))
                    .sort((a, b) => (b.performance.tickets_today || 0) - (a.performance.tickets_today || 0));
            }

            computeOnlineAgents(agents = []) {
                return agents
                    .filter(agent => agent.status === 'online')
                    .map(agent => ({
                        id: agent.id,
                        name: agent.name,
                        current_counter: agent.current_counter,
                        services: agent.services || []
                    }));
            }

            updateOnlineAgents(onlineAgents = []) {
                const grid = document.getElementById('onlineAgentsGrid');
                if (!grid) return;

                grid.innerHTML = '';

                if (onlineAgents.length === 0) {
                    grid.innerHTML = '<div class="online-agent-loading">No agents currently online</div>';
                    return;
                }

                onlineAgents.forEach((agent) => {
                    const initials = agent.name
                        .split(' ')
                        .map((n) => n[0])
                        .join('');
                    const item = document.createElement('div');
                    item.className = 'online-agent-card';
                    item.innerHTML = `
                        <div class="agent-avatar" style="background: ${this.getAgentColor(agent.id)};">
                            ${initials}
                        </div>
                        <div class="agent-info">
                            <div class="agent-name">${agent.name}</div>
                            <div class="agent-status">${agent.current_counter || 'Available'}</div>
                            <div class="agent-services-badges">
                                ${(agent.services || [])
                                    .map(
                                        (service) =>
                                            `<span class="service-badge ${service.prefix?.toLowerCase() || 'general'}">${service.prefix}</span>`
                                    )
                                    .join('')}
                            </div>
                        </div>
                    `;
                    grid.appendChild(item);
                });
            }

            updateAgentsTable(agents) {
                const tbody = document.getElementById('agentsTableBody');
                tbody.innerHTML = '';

                if (!agents || agents.length === 0) {
                    tbody.innerHTML = '<tr class="loading-row"><td colspan="8" class="text-center">No agents found</td></tr>';
                    return;
                }

                agents.forEach(agent => {
                    const initials = agent.name.split(' ').map(n => n[0]).join('');
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>
                            <div class="agent-cell">
                                <div class="agent-avatar" style="background: ${this.getAgentColor(agent.id)};">
                                    ${initials}
                                </div>
                                <div class="agent-details">
                                    <div class="agent-name">${agent.name}</div>
                                    <div class="agent-email">${agent.email || 'No email'}</div>
                                </div>
                            </div>
                        </td>
                        <td><code>${agent.username}</code></td>
                        <td>
                            <span class="agent-status-badge ${agent.status}">
                                ${this.getStatusIcon(agent.status)} ${this.capitalizeFirst(agent.status)}
                            </span>
                        </td>
                        <td>
                            <div class="agent-services">
                                ${agent.services.map(s => 
                                    `<span class="service-badge ${s.prefix.toLowerCase()}" title="${s.service_name} (${s.priority === 1 ? 'Primary' : 'Secondary'})">${s.prefix}</span>`
                                ).join('')}
                            </div>
                        </td>
                        <td>
                            ${agent.current_counter ? 
                                `<span class="agent-counter">${agent.current_counter}</span>` : 
                                '<span style="color: #9CA3AF;">Not assigned</span>'
                            }
                        </td>
                        <td>
                            <div class="agent-performance">
                                <span class="performance-number">${agent.performance.tickets_today}</span>
                                <span class="performance-label">tickets</span>
                            </div>
                        </td>
                        <td>
                            <span class="agent-role-badge ${agent.role}">${agent.role}</span>
                        </td>
                        <td>
                            <div class="agent-actions">
                                <button class="agent-action-btn edit" onclick="editAgent(${agent.id})" title="Edit Agent">
                                    
                                </button>
                                <button class="agent-action-btn reset" onclick="resetAgentPassword(${agent.id})" title="Reset Password">
                                    
                                </button>
                                <button class="agent-action-btn delete" onclick="deleteAgent(${agent.id}, '${agent.name}')" title="Delete Agent">
                                    
                                </button>
                            </div>
                        </td>
                    `;
                    tbody.appendChild(row);
                });

                // Store agents data for filtering
                this.agentsData = agents;
            }

            updateAgentPerformance(performance) {
                const grid = document.getElementById('agentPerformanceGrid');
                grid.innerHTML = '';

                if (!performance || performance.length === 0) {
                    grid.innerHTML = '<div class="performance-loading">No performance data available</div>';
                    return;
                }

                performance.forEach(agent => {
                    const item = document.createElement('div');
                    item.className = 'agent-performance-item';
                    item.innerHTML = `
                        <div class="performance-agent-name">${agent.name}</div>
                        <div class="performance-metrics">
                            <div class="performance-metric">
                                <span class="performance-metric-value">${agent.performance.tickets_today}</span>
                                <span class="performance-metric-label">Tickets</span>
                            </div>
                            <div class="performance-metric">
                                <span class="performance-metric-value">${agent.performance.avg_service_time}m</span>
                                <span class="performance-metric-label">Avg Time</span>
                            </div>
                            <div class="performance-metric">
                                <span class="performance-metric-value">${agent.performance.efficiency}%</span>
                                <span class="performance-metric-label">Efficiency</span>
                            </div>
                            <div class="performance-metric">
                                <span class="performance-metric-value">${agent.status === 'online' ? '' : ''}</span>
                                <span class="performance-metric-label">Status</span>
                            </div>
                        </div>
                    `;
                    grid.appendChild(item);
                });
            }

            getAgentColor(agentId) {
                const colors = ['#8B5CF6', '#10B981', '#F59E0B', '#3B82F6', '#EF4444'];
                return colors[agentId % colors.length];
            }

            getStatusIcon(status) {
                const icons = {
                    online: '',
                    offline: '',
                    break: ''
                };
                return icons[status] || '';
            }

            capitalizeFirst(str) {
                if (!str) return '';
                return str.charAt(0).toUpperCase() + str.slice(1);
            }

            filterAgents() {
                const searchTerm = document.getElementById('agentsSearch').value.toLowerCase();
                const tbody = document.getElementById('agentsTableBody');
                const rows = tbody.querySelectorAll('tr:not(.loading-row)');

                rows.forEach(row => {
                    const text = row.textContent.toLowerCase();
                    row.style.display = text.includes(searchTerm) ? '' : 'none';
                });
            }

            validateAgentForm(formData) {
                const errors = [];

                // Required field validation
                if (!formData.agentName.trim()) {
                    errors.push('Agent name is required');
                }

                if (!formData.agentUsername.trim()) {
                    errors.push('Username is required');
                }

                // Business logic validation
                if (formData.agentUsername.length < 3) {
                    errors.push('Username must be at least 3 characters');
                }

                if (formData.agentEmail && !this.isValidEmail(formData.agentEmail)) {
                    errors.push('Please enter a valid email address');
                }

                // Check for duplicate username
                const existingUsernames = this.agentsData?.map(a => a.username.toLowerCase()) || [];
                const currentId = formData.agentId;
                const currentAgent = this.agentsData?.find(a => a.id == currentId);
                
                if (existingUsernames.includes(formData.agentUsername.toLowerCase()) && 
                    (!currentAgent || currentAgent.username.toLowerCase() !== formData.agentUsername.toLowerCase())) {
                    errors.push('Username already exists');
                }

                // Service assignment validation
                if (!formData.services || formData.services.length === 0) {
                    errors.push('At least one service must be assigned');
                }

                return errors;
            }

            isValidEmail(email) {
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                return emailRegex.test(email);
            }

            async saveAgentData(agentData) {
                try {
                    const isEdit = agentData.agentId;
                    const method = isEdit ? 'PUT' : 'POST';
                    const url = isEdit ? `/admin/agents/${agentData.agentId}` : '/admin/agents';

                    const response = await this.apiCall(url, {
                        method,
                        body: JSON.stringify({
                            name: agentData.agentName,
                            username: agentData.agentUsername,
                            email: agentData.agentEmail,
                            role: agentData.agentRole,
                            is_active: agentData.agentActive,
                            password: agentData.agentPassword,
                            services: agentData.services
                        })
                    });

                    const result = await response.json();

                    if (response.ok) {
                        const baseMessage = isEdit ? 'Agent updated successfully!' : 'Agent created successfully!';
                        if (result.temporaryPassword) {
                            this.showSuccess(`${baseMessage} Temporary password: ${result.temporaryPassword}`);
                        } else {
                            this.showSuccess(baseMessage);
                        }
                        await this.loadAgentsData();
                        return true;
                    } else {
                        throw new Error(result.error || result.message || 'Failed to save agent');
                    }
                } catch (error) {
                    console.error('Error saving agent:', error);
                    this.showError('Error saving agent: ' + error.message);
                    return false;
                }
            }

            async deleteAgentData(agentId) {
                try {
                    const response = await this.apiCall(`/admin/agents/${agentId}`, {
                        method: 'DELETE'
                    });

                    if (response.ok) {
                        this.showSuccess('Agent deleted successfully!');
                        await this.loadAgentsData();
                        return true;
                    } else {
                        const error = await response.json();
                        throw new Error(error.message || 'Failed to delete agent');
                    }
                } catch (error) {
                    console.error('Error deleting agent:', error);
                    this.showError('Error deleting agent: ' + error.message);
                    return false;
                }
            }

            async resetAgentPasswordData(agentId) {
                try {
                    const response = await this.apiCall(`/admin/agents/${agentId}/reset-password`, {
                        method: 'POST'
                    });

                    if (response.ok) {
                        const result = await response.json();
                        this.showSuccess(`Password reset successfully! New password: ${result.temporaryPassword}`);
                        return true;
                    } else {
                        const error = await response.json();
                        throw new Error(error.message || 'Failed to reset password');
                    }
                } catch (error) {
                    console.error('Error resetting password:', error);
                    this.showError('Error resetting password: ' + error.message);
                    return false;
                }
            }

            async loadSettingsData() {
                try {
                    console.log('Loading settings data...');
                    
                    // Load settings, stats, and change log
                    const [settingsData, statsData, changeLog] = await Promise.all([
                        this.loadSystemSettings(),
                        this.loadSettingsStats(),
                        this.loadSettingsChangeLog()
                    ]);

                    this.updateSettingsForm(settingsData);
                    this.updateSettingsStats(statsData);
                    this.updateSettingsLog(changeLog);

                    // Setup real-time settings monitoring
                    this.setupSettingsMonitoring();

                } catch (error) {
                    console.error('Error loading settings data:', error);
                    this.showError('Error loading settings data. Please try again.');
                }
            }

            async loadSystemSettings() {
                try {
                    // This will eventually call /api/admin/settings (which already exists!)
                    const response = await this.apiCall('/admin/settings');
                    
                    if (response.ok) {
                        const payload = await response.json();
                        if (payload?.normalized) {
                            return {
                                ...this.getDefaultSettings(),
                                ...payload.normalized
                            };
                        }
                        if (Array.isArray(payload?.settings)) {
                            const normalized = payload.settings.reduce((acc, row) => {
                                acc[row.key] = row.value;
                                return acc;
                            }, {});
                            return {
                                ...this.getDefaultSettings(),
                                ...normalized
                            };
                        }
                        return payload || this.getDefaultSettings();
                    }
                    // Return default settings if API call fails
                    return this.getDefaultSettings();
                } catch (error) {
                    console.error('Error loading system settings:', error);
                    return this.getDefaultSettings();
                }
            }

            getDefaultSettings() {
                return {
                    // Feature flags
                    voiceEnabled: true,
                    printEnabled: true,
                    cherryPickEnabled: false,
                    parkEnabled: false,
                    recycleEnabled: true,
                    autoCallEnabled: false,
                    
                    // Queue settings
                    maxRecalls: 3,
                    recallInterval: 30,
                    ticketTimeout: 15,
                    maxWaitingTickets: 100,
                    
                    // Display settings
                    refreshInterval: 5,
                    showWaitTime: 'always',
                    
                    // Security settings
                    sessionTimeout: 60,
                    adminSessionTimeout: 30,
                    
                    // Language settings
                    defaultLanguage: 'en',
                    enabledLanguages: ['en', 'th', 'hi'],
                    timeFormat: '24',
                    timezone: 'Asia/Bangkok',
                    dateFormat: 'DD/MM/YYYY',
                    
                    // Backup settings
                    autoBackup: true,
                    backupFrequency: 'daily',
                    dataRetention: 90,
                    logRetention: 30
                };
            }

            async loadSettingsStats() {
                const settings = await this.loadSystemSettings();
                
                // Count active features (boolean flags that are true)
                const featureFlags = ['voiceEnabled', 'printEnabled', 'cherryPickEnabled', 'parkEnabled', 'recycleEnabled', 'autoCallEnabled'];
                const activeFeatures = featureFlags.filter(flag => settings[flag]).length;
                
                return {
                    activeFeatures,
                    lastModified: '2 hrs ago',
                    systemHealth: 'Healthy',
                    configVersion: 'v2.4'
                };
            }

            async loadSettingsChangeLog() {
                try {
                    // This would eventually call /api/admin/settings/changelog
                    return [
                        {
                            time: '2 hours ago',
                            user: 'Admin User',
                            change: 'Enabled Voice Announcements',
                            type: 'feature_flag'
                        },
                        {
                            time: '1 day ago',
                            user: 'System',
                            change: 'Auto backup completed successfully',
                            type: 'system'
                        },
                        {
                            time: '3 days ago',
                            user: 'Admin User',
                            change: 'Updated max waiting tickets to 100',
                            type: 'config'
                        },
                        {
                            time: '1 week ago',
                            user: 'Admin User',
                            change: 'Added Hindi language support',
                            type: 'language'
                        }
                    ];
                } catch (error) {
                    console.error('Error loading settings change log:', error);
                    return [];
                }
            }

            updateSettingsStats(stats) {
                document.getElementById('activeFeatures').textContent = stats.activeFeatures;
                document.getElementById('lastModified').textContent = stats.lastModified;
                document.getElementById('systemHealth').textContent = stats.systemHealth;
                document.getElementById('configVersion').textContent = stats.configVersion;
            }

            updateSettingsForm(settings) {
                // Update feature flags
                document.getElementById('voiceEnabled').checked = settings.voiceEnabled || false;
                document.getElementById('printEnabled').checked = settings.printEnabled || false;
                document.getElementById('cherryPickEnabled').checked = settings.cherryPickEnabled || false;
                document.getElementById('parkEnabled').checked = settings.parkEnabled || false;
                document.getElementById('recycleEnabled').checked = settings.recycleEnabled || false;
                document.getElementById('autoCallEnabled').checked = settings.autoCallEnabled || false;

                // Update queue settings
                document.getElementById('maxRecalls').value = settings.maxRecalls || 3;
                document.getElementById('recallInterval').value = settings.recallInterval || 30;
                document.getElementById('ticketTimeout').value = settings.ticketTimeout || 15;
                document.getElementById('maxWaitingTickets').value = settings.maxWaitingTickets || 100;

                // Update display settings
                document.getElementById('refreshInterval').value = settings.refreshInterval || 5;
                document.getElementById('showWaitTime').value = settings.showWaitTime || 'always';

                // Update security settings
                document.getElementById('sessionTimeout').value = settings.sessionTimeout || 60;
                document.getElementById('adminSessionTimeout').value = settings.adminSessionTimeout || 30;

                // Update language settings
                document.getElementById('defaultLanguage').value = settings.defaultLanguage || 'en';
                document.getElementById('timeFormat').value = settings.timeFormat || '24';
                document.getElementById('timezone').value = settings.timezone || 'Asia/Bangkok';
                document.getElementById('dateFormat').value = settings.dateFormat || 'DD/MM/YYYY';

                // Update language checkboxes
                const enabledLanguages = settings.enabledLanguages || ['en'];
                document.querySelectorAll('input[name="languages"]').forEach(checkbox => {
                    checkbox.checked = enabledLanguages.includes(checkbox.value);
                });

                // Update backup settings
                document.getElementById('autoBackup').checked = settings.autoBackup || false;
                document.getElementById('backupFrequency').value = settings.backupFrequency || 'daily';
                document.getElementById('dataRetention').value = settings.dataRetention || 90;
                document.getElementById('logRetention').value = settings.logRetention || 30;

                // Store current settings for comparison
                this.currentSettings = settings;
            }

            updateSettingsLog(changeLog) {
                const logContainer = document.getElementById('settingsLog');
                logContainer.innerHTML = '';

                if (!changeLog || changeLog.length === 0) {
                    logContainer.innerHTML = '<div class="log-item"><div class="log-change">No recent changes</div></div>';
                    return;
                }

                changeLog.forEach(entry => {
                    const logItem = document.createElement('div');
                    logItem.className = 'log-item';
                    logItem.innerHTML = `
                        <div class="log-time">${entry.time}</div>
                        <div class="log-user">${entry.user}</div>
                        <div class="log-change">${entry.change}</div>
                    `;
                    logContainer.appendChild(logItem);
                });
            }

            collectSettingsFromForm() {
                return {
                    // Feature flags
                    voiceEnabled: document.getElementById('voiceEnabled').checked,
                    printEnabled: document.getElementById('printEnabled').checked,
                    cherryPickEnabled: document.getElementById('cherryPickEnabled').checked,
                    parkEnabled: document.getElementById('parkEnabled').checked,
                    recycleEnabled: document.getElementById('recycleEnabled').checked,
                    autoCallEnabled: document.getElementById('autoCallEnabled').checked,

                    // Queue settings
                    maxRecalls: parseInt(document.getElementById('maxRecalls').value),
                    recallInterval: parseInt(document.getElementById('recallInterval').value),
                    ticketTimeout: parseInt(document.getElementById('ticketTimeout').value),
                    maxWaitingTickets: parseInt(document.getElementById('maxWaitingTickets').value),

                    // Display settings
                    refreshInterval: parseInt(document.getElementById('refreshInterval').value),
                    showWaitTime: document.getElementById('showWaitTime').value,

                    // Security settings
                    sessionTimeout: parseInt(document.getElementById('sessionTimeout').value),
                    adminSessionTimeout: parseInt(document.getElementById('adminSessionTimeout').value),

                    // Language settings
                    defaultLanguage: document.getElementById('defaultLanguage').value,
                    timeFormat: document.getElementById('timeFormat').value,
                    timezone: document.getElementById('timezone').value,
                    dateFormat: document.getElementById('dateFormat').value,
                    enabledLanguages: Array.from(document.querySelectorAll('input[name="languages"]:checked')).map(cb => cb.value),

                    // Backup settings
                    autoBackup: document.getElementById('autoBackup').checked,
                    backupFrequency: document.getElementById('backupFrequency').value,
                    dataRetention: parseInt(document.getElementById('dataRetention').value),
                    logRetention: parseInt(document.getElementById('logRetention').value)
                };
            }

            validateSettings(settings) {
                const errors = [];

                // Validate numeric ranges
                if (settings.maxRecalls < 1 || settings.maxRecalls > 10) {
                    errors.push('Maximum recalls must be between 1 and 10');
                }

                if (settings.recallInterval < 10 || settings.recallInterval > 300) {
                    errors.push('Recall interval must be between 10 and 300 seconds');
                }

                if (settings.ticketTimeout < 5 || settings.ticketTimeout > 60) {
                    errors.push('Ticket timeout must be between 5 and 60 minutes');
                }

                if (settings.maxWaitingTickets < 10 || settings.maxWaitingTickets > 500) {
                    errors.push('Max waiting tickets must be between 10 and 500');
                }

                if (settings.refreshInterval < 1 || settings.refreshInterval > 30) {
                    errors.push('Display refresh interval must be between 1 and 30 seconds');
                }

                if (settings.sessionTimeout < 15 || settings.sessionTimeout > 480) {
                    errors.push('Session timeout must be between 15 and 480 minutes');
                }

                if (settings.adminSessionTimeout < 10 || settings.adminSessionTimeout > 120) {
                    errors.push('Admin session timeout must be between 10 and 120 minutes');
                }

                if (settings.dataRetention < 7 || settings.dataRetention > 365) {
                    errors.push('Data retention must be between 7 and 365 days');
                }

                if (settings.logRetention < 7 || settings.logRetention > 90) {
                    errors.push('Log retention must be between 7 and 90 days');
                }

                // Validate that at least one language is enabled
                if (!settings.enabledLanguages || settings.enabledLanguages.length === 0) {
                    errors.push('At least one language must be enabled');
                }

                // Validate that default language is in enabled languages
                if (!settings.enabledLanguages.includes(settings.defaultLanguage)) {
                    errors.push('Default language must be one of the enabled languages');
                }

                return errors;
            }

            async saveSettingsData(settings) {
                try {
                    const response = await this.apiCall('/admin/settings', {
                        method: 'PUT',
                        body: JSON.stringify(settings)
                    });

                    if (response.ok) {
                        this.showSuccess('Settings saved successfully!');
                        await this.loadSettingsData(); // Refresh to show changes
                        return true;
                    } else {
                        const error = await response.json();
                        throw new Error(error.message || 'Failed to save settings');
                    }
                } catch (error) {
                    console.error('Error saving settings:', error);
                    this.showError('Error saving settings: ' + error.message);
                    return false;
                }
            }

            async resetSettingsToDefaults() {
                try {
                    const defaultSettings = this.getDefaultSettings();
                    const success = await this.saveSettingsData(defaultSettings);
                    
                    if (success) {
                        this.showSuccess('Settings reset to defaults successfully!');
                    }
                    
                    return success;
                } catch (error) {
                    console.error('Error resetting settings:', error);
                    this.showError('Error resetting settings: ' + error.message);
                    return false;
                }
            }

            setupSettingsMonitoring() {
                // Add change listeners to all form elements for real-time validation
                const formElements = document.querySelectorAll('#settings-section input, #settings-section select');
                
                formElements.forEach(element => {
                    element.addEventListener('change', () => {
                        this.markSettingsAsModified();
                    });
                });

                // Auto-save settings after a delay when modified
                this.settingsAutoSaveTimeout = null;
            }

            markSettingsAsModified() {
                // Visual indication that settings have been modified
                const saveButton = document.querySelector('button[onclick="saveAllSettings()"]');
                if (saveButton) {
                    saveButton.textContent = ' Save Changes*';
                    saveButton.classList.add('modified');
                }

                // Clear previous auto-save timeout
                if (this.settingsAutoSaveTimeout) {
                    clearTimeout(this.settingsAutoSaveTimeout);
                }

                // Set new auto-save timeout (optional feature)
                // this.settingsAutoSaveTimeout = setTimeout(() => {
                //     this.autoSaveSettings();
                // }, 5000); // Auto-save after 5 seconds of no changes
            }

            async loadCountersData() {
                try {
                    console.log('Loading counters data...');
                    
                    // Load counters from API
                    const response = await fetch(`${this.apiBase}/admin/counters`, {
                        headers: {
                            'Authorization': `Bearer ${this.token}`
                        }
                    });
                    
                    if (!response.ok) {
                        throw new Error('Failed to load counters');
                    }
                    
                    const data = await response.json();
                    
                    // Update statistics
                    this.updateCounterStats(data.counters);
                    
                    // Update counter status grid
                    this.updateCounterStatusGrid(data.counters);
                    
                    // Update counters table
                    this.updateCountersTable(data.counters);
                    
                    // Initialize counter performance chart
                    this.initializeCounterChart();
                    
                } catch (error) {
                    console.error('Error loading counters:', error);
                    this.showError('Failed to load counters data');
                }
            }
            
            updateCounterStats(counters) {
                const totalCounters = counters.length;
                const activeCounters = counters.filter(c => c.is_active && c.agent_id).length;
                const ticketsToday = counters.reduce((sum, c) => sum + (c.tickets_served_today || 0), 0);
                
                // Find busiest counter
                let busiestCounter = 'None';
                let maxTickets = 0;
                counters.forEach(counter => {
                    if (counter.tickets_served_today > maxTickets) {
                        maxTickets = counter.tickets_served_today;
                        busiestCounter = counter.name;
                    }
                });
                
                document.getElementById('totalCounters').textContent = totalCounters;
                document.getElementById('activeCounters').textContent = activeCounters;
                document.getElementById('busiestCounter').textContent = busiestCounter;
                document.getElementById('totalServedToday').textContent = ticketsToday;
            }
            
            updateCounterStatusGrid(counters) {
                const grid = document.querySelector('.counter-status-grid');
                grid.innerHTML = '';
                
                counters.forEach(counter => {
                    const statusCard = this.createCounterStatusCard(counter);
                    grid.appendChild(statusCard);
                });
            }
            
            createCounterStatusCard(counter) {
                const card = document.createElement('div');
                card.className = 'counter-status-card';
                
                // Determine status
                let status = 'inactive';
                let statusText = 'Inactive';
                let statusBadgeClass = 'inactive';
                
                if (counter.is_active) {
                    if (counter.agent_id) {
                        if (counter.current_ticket) {
                            status = 'serving';
                            statusText = 'Serving';
                            statusBadgeClass = 'serving';
                        } else {
                            status = 'active';
                            statusText = 'Active';
                            statusBadgeClass = 'active';
                        }
                    } else {
                        statusText = 'No Agent';
                    }
                }
                
                card.classList.add(status);
                
                card.innerHTML = `
                    <div class="counter-status-number">${counter.counter_number}</div>
                    <div class="counter-status-label">${counter.name}</div>
                    ${counter.agent_name ? `<div class="counter-status-agent">${counter.agent_name}</div>` : ''}
                    ${counter.current_ticket ? `<div class="counter-status-ticket">Serving: ${counter.current_ticket}</div>` : ''}
                    <div class="counter-status-badge ${statusBadgeClass}">${statusText}</div>
                `;
                
                card.onclick = () => this.viewCounterDetails(counter.id);
                
                return card;
            }
            
            updateCountersTable(counters) {
                const tbody = document.getElementById('countersTableBody');
                tbody.innerHTML = '';
                
                counters.forEach(counter => {
                    const row = this.createCounterRow(counter);
                    tbody.appendChild(row);
                });
            }
            
            createCounterRow(counter) {
                const row = document.createElement('tr');
                
                // Service badges
                const services = counter.services || [];
                const serviceBadges = services.map(s => 
                    `<span class="service-badge ${this.getServiceClass(s.service_letter)}">${s.service_letter}</span>`
                ).join(' ');
                
                // Status badge
                const statusClass = counter.is_active ? 'success' : 'inactive';
                const statusText = counter.is_active ? 'Active' : 'Inactive';
                
                row.innerHTML = `
                    <td>${counter.counter_number}</td>
                    <td>${counter.name}</td>
                    <td>${counter.location || '-'}</td>
                    <td>${counter.agent_name || 'Unassigned'}</td>
                    <td>${serviceBadges || 'None'}</td>
                    <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                    <td>${counter.tickets_served_today || 0}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="icon-btn" onclick="editCounter(${counter.id})" title="Edit">
                                <i class="icon"></i>
                            </button>
                            <button class="icon-btn" onclick="toggleCounterStatus(${counter.id}, ${counter.is_active})" title="${counter.is_active ? 'Deactivate' : 'Activate'}">
                                <i class="icon">${counter.is_active ? '' : ''}</i>
                            </button>
                            <button class="icon-btn danger" onclick="deleteCounter(${counter.id})" title="Delete">
                                <i class="icon"></i>
                            </button>
                        </div>
                    </td>
                `;
                
                return row;
            }
            
            getServiceClass(serviceLetter) {
                const serviceClasses = {
                    'A': 'general',
                    'B': 'account',
                    'V': 'vip',
                    'T': 'technical'
                };
                return serviceClasses[serviceLetter] || 'general';
            }
            
            initializeCounterChart() {
                const ctx = document.getElementById('counterPerformanceChart');
                if (!ctx) return;
                
                // Initialize Chart.js chart for counter performance
                // This is a placeholder - implement actual chart logic
                console.log('Counter performance chart initialized');
            }
            
            viewCounterDetails(counterId) {
                console.log('View counter details:', counterId);
                // Implement counter details view
            }

            async loadMaintenanceData() {
                try {
                    console.log('Loading maintenance data...');
                    
                    // Load maintenance data, system health, and logs
                    const [systemHealth, maintenanceStats, logData, backupData] = await Promise.all([
                        this.loadSystemHealth(),
                        this.loadMaintenanceStats(),
                        this.loadSystemLogs(),
                        this.loadBackupData()
                    ]);

                    this.updateMaintenanceStats(maintenanceStats);
                    this.updateSystemHealth(systemHealth);
                    this.updateSystemLogs(logData);
                    this.updateBackupData(backupData);

                    // Setup real-time monitoring
                    this.setupMaintenanceMonitoring();

                } catch (error) {
                    console.error('Error loading maintenance data:', error);
                    this.showError('Error loading maintenance data. Please try again.');
                }
            }

            async loadSystemHealth() {
                try {
                    // This will eventually call /api/admin/system/health
                    return {
                        cpu: 23,
                        memory: 45,
                        diskIO: 12,
                        networkLoad: 8,
                        databaseConnections: 12,
                        maxConnections: 50,
                        activeSessions: 8,
                        queueSize: 23,
                        lastBackup: '6 hours ago',
                        uptime: 234567890, // milliseconds
                        responseTime: 45,
                        status: 'healthy'
                    };
                } catch (error) {
                    console.error('Error loading system health:', error);
                    return null;
                }
            }

            async loadMaintenanceStats() {
                try {
                    // This would call /api/admin/system/stats
                    return {
                        systemUptime: '2d 14h 32m',
                        memoryUsage: '45%',
                        diskSpace: '78%',
                        responseTime: '45ms'
                    };
                } catch (error) {
                    console.error('Error loading maintenance stats:', error);
                    return {
                        systemUptime: '--',
                        memoryUsage: '--',
                        diskSpace: '--',
                        responseTime: '--'
                    };
                }
            }

            async loadSystemLogs() {
                try {
                    // This would call /api/admin/system/logs
                    return [
                        {
                            timestamp: '2025-06-28 14:23:15',
                            level: 'error',
                            message: 'Database connection timeout (resolved automatically)'
                        },
                        {
                            timestamp: '2025-06-28 14:15:08',
                            level: 'warning',
                            message: 'High memory usage detected: 89% (threshold: 85%)'
                        },
                        {
                            timestamp: '2025-06-28 14:10:22',
                            level: 'info',
                            message: 'Backup completed successfully: backup_2025-06-28_14-10.db'
                        },
                        {
                            timestamp: '2025-06-28 13:45:11',
                            level: 'info',
                            message: 'Agent \'Sarah Chen\' logged in from 192.168.1.15'
                        },
                        {
                            timestamp: '2025-06-28 13:30:45',
                            level: 'debug',
                            message: 'Queue optimization completed: 15ms reduction in avg wait time'
                        }
                    ];
                } catch (error) {
                    console.error('Error loading system logs:', error);
                    return [];
                }
            }

            async loadBackupData() {
                try {
                    // This would call /api/admin/system/backups
                    return {
                        lastBackup: '6 hours ago',
                        backupSize: '24.7 MB',
                        autoBackup: true,
                        backupFrequency: 'Daily',
                        backups: [
                            {
                                filename: 'backup_2025-06-28_08-00.db',
                                date: 'Today, 8:00 AM',
                                size: '24.7 MB',
                                timestamp: '2025-06-28T08:00:00Z'
                            },
                            {
                                filename: 'backup_2025-06-27_08-00.db',
                                date: 'Yesterday, 8:00 AM',
                                size: '23.1 MB',
                                timestamp: '2025-06-27T08:00:00Z'
                            },
                            {
                                filename: 'backup_2025-06-26_08-00.db',
                                date: '2 days ago, 8:00 AM',
                                size: '22.4 MB',
                                timestamp: '2025-06-26T08:00:00Z'
                            }
                        ]
                    };
                } catch (error) {
                    console.error('Error loading backup data:', error);
                    return null;
                }
            }

            updateMaintenanceStats(stats) {
                document.getElementById('systemUptime').textContent = stats.systemUptime;
                document.getElementById('memoryUsage').textContent = stats.memoryUsage;
                document.getElementById('diskSpace').textContent = stats.diskSpace;
                document.getElementById('responseTime').textContent = stats.responseTime;
            }

            updateSystemHealth(health) {
                if (!health) return;

                // Update health metrics in the system health card
                const healthMetrics = document.querySelectorAll('.health-metric');
                
                // Update CPU usage
                const cpuMetric = healthMetrics[0];
                if (cpuMetric) {
                    cpuMetric.querySelector('.metric-value').textContent = `${health.cpu}%`;
                    cpuMetric.querySelector('.metric-fill').style.width = `${health.cpu}%`;
                    cpuMetric.querySelector('.metric-fill').className = `metric-fill ${this.getHealthLevel(health.cpu)}`;
                }

                // Update Memory usage
                const memoryMetric = healthMetrics[1];
                if (memoryMetric) {
                    memoryMetric.querySelector('.metric-value').textContent = `${health.memory}%`;
                    memoryMetric.querySelector('.metric-fill').style.width = `${health.memory}%`;
                    memoryMetric.querySelector('.metric-fill').className = `metric-fill ${this.getHealthLevel(health.memory)}`;
                }

                // Update Disk I/O
                const diskMetric = healthMetrics[2];
                if (diskMetric) {
                    diskMetric.querySelector('.metric-value').textContent = `${health.diskIO}%`;
                    diskMetric.querySelector('.metric-fill').style.width = `${health.diskIO}%`;
                    diskMetric.querySelector('.metric-fill').className = `metric-fill ${this.getHealthLevel(health.diskIO)}`;
                }

                // Update Network Load
                const networkMetric = healthMetrics[3];
                if (networkMetric) {
                    networkMetric.querySelector('.metric-value').textContent = `${health.networkLoad}%`;
                    networkMetric.querySelector('.metric-fill').style.width = `${health.networkLoad}%`;
                    networkMetric.querySelector('.metric-fill').className = `metric-fill ${this.getHealthLevel(health.networkLoad)}`;
                }

                // Update health details
                const healthDetails = document.querySelectorAll('.detail-value');
                if (healthDetails.length >= 4) {
                    healthDetails[0].textContent = `${health.databaseConnections}/${health.maxConnections}`;
                    healthDetails[1].textContent = health.activeSessions.toString();
                    healthDetails[2].textContent = `${health.queueSize} tickets`;
                    healthDetails[3].textContent = health.lastBackup;
                }
            }

            getHealthLevel(percentage) {
                if (percentage < 30) return 'excellent';
                if (percentage < 60) return 'good';
                if (percentage < 80) return 'warning';
                return 'critical';
            }

            updateSystemLogs(logs) {
                const logViewer = document.getElementById('logViewer');
                if (!logViewer) return;

                logViewer.innerHTML = '';

                if (!logs || logs.length === 0) {
                    logViewer.innerHTML = '<div style="color: #9CA3AF; text-align: center; padding: 40px;">No logs available</div>';
                    return;
                }

                logs.forEach(log => {
                    const logEntry = document.createElement('div');
                    logEntry.className = `log-entry ${log.level}`;
                    logEntry.innerHTML = `
                        <div class="log-timestamp">${log.timestamp}</div>
                        <div class="log-level">${log.level.toUpperCase()}</div>
                        <div class="log-message">${log.message}</div>
                    `;
                    logViewer.appendChild(logEntry);
                });
            }

            updateBackupData(backupData) {
                if (!backupData) return;

                // Update backup status info (already set in HTML for demo)
                console.log('Backup data loaded:', backupData);
            }

            setupMaintenanceMonitoring() {
                // Auto-refresh maintenance data every 30 seconds
                setInterval(() => {
                    if (this.currentSection === 'maintenance') {
                        this.refreshMaintenanceData();
                    }
                }, 30000);

                // Setup real-time health monitoring
                if (typeof io !== 'undefined') {
                    const socket = io('/admin');
                    
                    socket.on('system-health-update', (data) => {
                        this.updateSystemHealth(data);
                    });

                    socket.on('new-log-entry', (logEntry) => {
                        this.addLogEntry(logEntry);
                    });
                }
            }

            async refreshMaintenanceData() {
                try {
                    const [systemHealth, maintenanceStats] = await Promise.all([
                        this.loadSystemHealth(),
                        this.loadMaintenanceStats()
                    ]);

                    this.updateSystemHealth(systemHealth);
                    this.updateMaintenanceStats(maintenanceStats);
                } catch (error) {
                    console.error('Error refreshing maintenance data:', error);
                }
            }

            addLogEntry(logEntry) {
                const logViewer = document.getElementById('logViewer');
                if (!logViewer) return;

                const logElement = document.createElement('div');
                logElement.className = `log-entry ${logEntry.level}`;
                logElement.innerHTML = `
                    <div class="log-timestamp">${logEntry.timestamp}</div>
                    <div class="log-level">${logEntry.level.toUpperCase()}</div>
                    <div class="log-message">${logEntry.message}</div>
                `;

                // Add to top of log viewer
                logViewer.insertBefore(logElement, logViewer.firstChild);

                // Keep only last 50 entries
                while (logViewer.children.length > 50) {
                    logViewer.removeChild(logViewer.lastChild);
                }
            }

            async performMaintenanceOperation(operation, data = {}) {
                try {
                    const response = await this.apiCall('/admin/system/maintenance', {
                        method: 'POST',
                        body: JSON.stringify({
                            operation,
                            data
                        })
                    });

                    if (response.ok) {
                        const result = await response.json();
                        this.showSuccess(`${operation} completed successfully!`);
                        
                        // Refresh maintenance data after operation
                        await this.refreshMaintenanceData();
                        
                        return result;
                    } else {
                        const error = await response.json();
                        throw new Error(error.message || `Failed to perform ${operation}`);
                    }
                } catch (error) {
                    console.error(`Error performing ${operation}:`, error);
                    this.showError(`Error performing ${operation}: ${error.message}`);
                    return false;
                }
            }

            async runSystemDiagnostics() {
                try {
                    const response = await this.apiCall('/admin/system/diagnostics', {
                        method: 'POST'
                    });

                    if (response.ok) {
                        const diagnostics = await response.json();
                        this.updateDiagnosticsResults(diagnostics);
                        this.showSuccess('System diagnostics completed successfully!');
                        return diagnostics;
                    } else {
                        throw new Error('Failed to run diagnostics');
                    }
                } catch (error) {
                    console.error('Error running diagnostics:', error);
                    this.showError('Error running system diagnostics: ' + error.message);
                    return false;
                }
            }

            updateDiagnosticsResults(diagnostics) {
                // Update diagnostic test results
                // For now, this is handled by the static HTML content
                console.log('Diagnostics results:', diagnostics);
            }

            filterLogsByLevel(level) {
                const logEntries = document.querySelectorAll('.log-entry');
                
                logEntries.forEach(entry => {
                    if (level === 'all' || entry.classList.contains(level)) {
                        entry.style.display = 'grid';
                    } else {
                        entry.style.display = 'none';
                    }
                });
            }

            filterLogsByPeriod(period) {
                // This would filter logs by time period
                // For now, we'll just log the filter selection
                console.log(`Filtering logs by period: ${period}`);
            }

            async exportSystemLogs() {
                try {
                    const level = document.getElementById('logLevel').value;
                    const period = document.getElementById('logPeriod').value;
                    
                    const response = await this.apiCall('/admin/system/logs/export', {
                        method: 'POST',
                        body: JSON.stringify({
                            level: level === 'all' ? null : level,
                            period
                        })
                    });

                    if (response.ok) {
                        const blob = await response.blob();
                        const url = window.URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = `flowmatic-logs-${period}-${new Date().toISOString().split('T')[0]}.txt`;
                        document.body.appendChild(a);
                        a.click();
                        window.URL.revokeObjectURL(url);
                        document.body.removeChild(a);
                        
                        this.showSuccess('System logs exported successfully!');
                    } else {
                        throw new Error('Failed to export logs');
                    }
                } catch (error) {
                    console.error('Error exporting logs:', error);
                    this.showError('Error exporting logs: ' + error.message);
                }
            }

            resetSaveButton() {
                const saveButton = document.querySelector('button[onclick="saveAllSettings()"]');
                if (saveButton) {
                    saveButton.textContent = ' Save Changes';
                    saveButton.classList.remove('modified');
                }
            }

            async apiCall(endpoint, options = {}) {
                const config = {
                    headers: {
                        'Authorization': `Bearer ${this.token}`,
                        'Content-Type': 'application/json',
                        ...options.headers
                    },
                    ...options
                };

                const response = await fetch(`${this.apiBase}${endpoint}`, config);
                
                if (response.status === 401) {
                    this.handleLogout();
                    throw new Error('Unauthorized');
                }

                return response;
            }
        }

        // Initialize admin panel when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            window.adminPanel = new AdminPanel();
        });

        // Global functions for services management
        let currentServiceIdToDelete = null;

        async function addService() {
            // Reset form for new service
            document.getElementById('serviceForm').reset();
            document.getElementById('serviceId').value = '';
            document.getElementById('serviceModalTitle').textContent = 'Add New Service';
            document.getElementById('saveButtonText').textContent = 'Create Service';
            document.getElementById('isActive').checked = true;
            
            // Clear validation messages
            const validationDiv = document.getElementById('validationMessages');
            validationDiv.classList.remove('show');
            
            // Show modal
            document.getElementById('serviceModal').classList.add('show');
        }

        async function editService(serviceId) {
            const service = window.adminPanel.servicesData?.find(s => s.id === serviceId);
            if (!service) {
                alert('Service not found');
                return;
            }

            // Populate form with service data
            document.getElementById('serviceId').value = service.id;
            document.getElementById('serviceName').value = service.name;
            document.getElementById('servicePrefix').value = service.prefix;
            document.getElementById('serviceDescription').value = service.description || '';
            document.getElementById('rangeStart').value = service.range_start;
            document.getElementById('rangeEnd').value = service.range_end;
            document.getElementById('currentNumber').value = service.current_number;
            document.getElementById('estimatedServiceTime').value = service.estimated_service_time;
            document.getElementById('isActive').checked = service.is_active;

            // Update modal title
            document.getElementById('serviceModalTitle').textContent = 'Edit Service';
            document.getElementById('saveButtonText').textContent = 'Update Service';
            
            // Clear validation messages
            const validationDiv = document.getElementById('validationMessages');
            validationDiv.classList.remove('show');
            
            // Show modal
            document.getElementById('serviceModal').classList.add('show');
        }

        async function saveService(event) {
            event.preventDefault();
            
            const form = document.getElementById('serviceForm');
            const formData = new FormData(form);
            const serviceData = {
                serviceId: formData.get('serviceId'),
                serviceName: formData.get('serviceName'),
                servicePrefix: formData.get('servicePrefix').toUpperCase(),
                serviceDescription: formData.get('serviceDescription'),
                rangeStart: formData.get('rangeStart'),
                rangeEnd: formData.get('rangeEnd'),
                currentNumber: formData.get('currentNumber'),
                estimatedServiceTime: formData.get('estimatedServiceTime'),
                isActive: formData.get('isActive') === 'on'
            };

            // Validate form
            const errors = window.adminPanel.validateServiceForm(serviceData);
            if (errors.length > 0) {
                const validationDiv = document.getElementById('validationMessages');
                validationDiv.innerHTML = errors.map(error => ` ${error}`).join('<br>');
                validationDiv.classList.add('show');
                return;
            }

            // Hide validation messages
            document.getElementById('validationMessages').classList.remove('show');

            // Disable submit button
            const submitBtn = event.target.querySelector('button[type="submit"]');
            const originalText = submitBtn.textContent;
            submitBtn.disabled = true;
            submitBtn.textContent = 'Saving...';

            try {
                const success = await window.adminPanel.saveServiceData(serviceData);
                if (success) {
                    closeServiceModal();
                }
            } finally {
                // Re-enable submit button
                submitBtn.disabled = false;
                submitBtn.textContent = originalText;
            }
        }

        function closeServiceModal() {
            document.getElementById('serviceModal').classList.remove('show');
        }

        async function deleteService(serviceId, serviceName) {
            currentServiceIdToDelete = serviceId;
            document.getElementById('deleteServiceName').textContent = serviceName;
            document.getElementById('deleteConfirmModal').classList.add('show');
        }

        function closeDeleteModal() {
            document.getElementById('deleteConfirmModal').classList.remove('show');
            currentServiceIdToDelete = null;
        }

        async function confirmDeleteService() {
            if (!currentServiceIdToDelete) return;

            const success = await window.adminPanel.deleteServiceData(currentServiceIdToDelete);
            if (success) {
                closeDeleteModal();
            }
        }

        async function toggleService(serviceId) {
            if (confirm('Are you sure you want to change the status of this service?')) {
                await window.adminPanel.toggleServiceStatus(serviceId);
            }
        }

        function filterServices() {
            if (window.adminPanel) {
                window.adminPanel.filterServices();
            }
        }

        async function refreshServiceStats() {
            if (window.adminPanel && window.adminPanel.currentSection === 'services') {
                await window.adminPanel.loadServicesData();
                
                // Visual feedback
                const btn = event.target;
                btn.style.transform = 'rotate(360deg)';
                setTimeout(() => {
                    btn.style.transform = 'rotate(0deg)';
                }, 500);
            }
        }

        // Close modals when clicking outside
        window.addEventListener('click', function(event) {
            const serviceModal = document.getElementById('serviceModal');
            const deleteModal = document.getElementById('deleteConfirmModal');
            
            if (event.target === serviceModal) {
                closeServiceModal();
            }
            
            if (event.target === deleteModal) {
                closeDeleteModal();
            }
        });

        // Global functions for agents management
        let currentAgentIdToDelete = null;

        async function addAgent() {
            // Reset form for new agent
            document.getElementById('agentForm').reset();
            document.getElementById('agentId').value = '';
            document.getElementById('agentModalTitle').textContent = 'Add New Agent';
            document.getElementById('agentSaveButtonText').textContent = 'Create Agent';
            document.getElementById('agentActive').checked = true;
            
            // Reset service assignments
            document.querySelectorAll('input[name="services"]').forEach(checkbox => {
                checkbox.checked = false;
            });
            document.querySelectorAll('.priority-select').forEach(select => {
                select.value = '1';
            });
            
            // Clear validation messages
            const validationDiv = document.getElementById('agentValidationMessages');
            validationDiv.classList.remove('show');
            
            // Show modal
            document.getElementById('agentModal').classList.add('show');
        }

        async function editAgent(agentId) {
            const agent = window.adminPanel.agentsData?.find(a => a.id === agentId);
            if (!agent) {
                alert('Agent not found');
                return;
            }

            // Populate form with agent data
            document.getElementById('agentId').value = agent.id;
            document.getElementById('agentName').value = agent.name;
            document.getElementById('agentUsername').value = agent.username;
            document.getElementById('agentEmail').value = agent.email || '';
            document.getElementById('agentRole').value = agent.role;
            document.getElementById('agentActive').checked = agent.is_active;
            document.getElementById('agentPassword').value = ''; // Always empty for security

            // Set service assignments
            document.querySelectorAll('input[name="services"]').forEach(checkbox => {
                checkbox.checked = false;
            });
            document.querySelectorAll('.priority-select').forEach(select => {
                select.value = '1';
            });
            
            agent.services.forEach(service => {
                const checkbox = document.querySelector(`input[name="services"][value="${service.service_id}"]`);
                if (checkbox) {
                    checkbox.checked = true;
                    const prioritySelect = document.querySelector(`select[name="priority_${service.service_id}"]`);
                    if (prioritySelect) {
                        prioritySelect.value = service.priority;
                    }
                }
            });

            // Update modal title
            document.getElementById('agentModalTitle').textContent = 'Edit Agent';
            document.getElementById('agentSaveButtonText').textContent = 'Update Agent';
            
            // Clear validation messages
            const validationDiv = document.getElementById('agentValidationMessages');
            validationDiv.classList.remove('show');
            
            // Show modal
            document.getElementById('agentModal').classList.add('show');
        }

        async function saveAgent(event) {
            event.preventDefault();
            
            const form = document.getElementById('agentForm');
            const formData = new FormData(form);
            
            // Collect service assignments
            const services = [];
            document.querySelectorAll('input[name="services"]:checked').forEach(checkbox => {
                const serviceId = checkbox.value;
                const prioritySelect = document.querySelector(`select[name="priority_${serviceId}"]`);
                services.push({
                    service_id: parseInt(serviceId),
                    priority: parseInt(prioritySelect.value)
                });
            });

            const agentData = {
                agentId: formData.get('agentId'),
                agentName: formData.get('agentName'),
                agentUsername: formData.get('agentUsername').toLowerCase(),
                agentEmail: formData.get('agentEmail'),
                agentRole: formData.get('agentRole'),
                agentPassword: formData.get('agentPassword'),
                agentActive: formData.get('agentActive') === 'on',
                services: services
            };

            // Validate form
            const errors = window.adminPanel.validateAgentForm(agentData);
            if (errors.length > 0) {
                const validationDiv = document.getElementById('agentValidationMessages');
                validationDiv.innerHTML = errors.map(error => ` ${error}`).join('<br>');
                validationDiv.classList.add('show');
                return;
            }

            // Hide validation messages
            document.getElementById('agentValidationMessages').classList.remove('show');

            // Disable submit button
            const submitBtn = event.target.querySelector('button[type="submit"]');
            const originalText = submitBtn.textContent;
            submitBtn.disabled = true;
            submitBtn.textContent = 'Saving...';

            try {
                const success = await window.adminPanel.saveAgentData(agentData);
                if (success) {
                    closeAgentModal();
                }
            } finally {
                // Re-enable submit button
                submitBtn.disabled = false;
                submitBtn.textContent = originalText;
            }
        }

        function closeAgentModal() {
            document.getElementById('agentModal').classList.remove('show');
        }

        async function deleteAgent(agentId, agentName) {
            currentAgentIdToDelete = agentId;
            document.getElementById('deleteAgentName').textContent = agentName;
            document.getElementById('deleteAgentModal').classList.add('show');
        }

        function closeDeleteAgentModal() {
            document.getElementById('deleteAgentModal').classList.remove('show');
            currentAgentIdToDelete = null;
        }

        async function confirmDeleteAgent() {
            if (!currentAgentIdToDelete) return;

            const success = await window.adminPanel.deleteAgentData(currentAgentIdToDelete);
            if (success) {
                closeDeleteAgentModal();
            }
        }

        async function resetAgentPassword(agentId) {
            if (confirm('Are you sure you want to reset this agent\'s password? A new temporary password will be generated.')) {
                await window.adminPanel.resetAgentPasswordData(agentId);
            }
        }

        function filterAgents() {
            if (window.adminPanel) {
                window.adminPanel.filterAgents();
            }
        }

        async function refreshAgentStats() {
            if (window.adminPanel && window.adminPanel.currentSection === 'agents') {
                await window.adminPanel.loadAgentsData();
                
                // Visual feedback
                const btn = event.target;
                btn.style.transform = 'rotate(360deg)';
                setTimeout(() => {
                    btn.style.transform = 'rotate(0deg)';
                }, 500);
            }
        }

        // Handle service checkbox change to show/hide priority select
        document.addEventListener('change', function(event) {
            if (event.target.name === 'services') {
                const serviceId = event.target.value;
                const prioritySelect = document.querySelector(`select[name="priority_${serviceId}"]`);
                if (prioritySelect) {
                    prioritySelect.style.display = event.target.checked ? 'block' : 'none';
                }
            }
        });

        // Close agent modals when clicking outside
        window.addEventListener('click', function(event) {
            const agentModal = document.getElementById('agentModal');
            const deleteAgentModal = document.getElementById('deleteAgentModal');
            
            if (event.target === agentModal) {
                closeAgentModal();
            }
            
            if (event.target === deleteAgentModal) {
                closeDeleteAgentModal();
            }
        });

        // Global functions for counters management
        async function refreshCounters() {
            if (window.adminPanel) {
                await window.adminPanel.loadCountersData();
            }
        }

        function openAddCounterModal() {
            // Reset form for new counter
            document.getElementById('counterForm').reset();
            document.getElementById('counterId').value = '';
            document.getElementById('counterModalTitle').textContent = 'Add New Counter';
            document.getElementById('counterSaveButtonText').textContent = 'Create Counter';
            document.getElementById('counterActive').checked = true;
            
            // Clear validation messages
            const validationDiv = document.getElementById('counterValidationMessages');
            if (validationDiv) {
                validationDiv.innerHTML = '';
                validationDiv.classList.remove('show');
            }
            
            // Show modal
            document.getElementById('addCounterModal').classList.add('show');
        }

        async function editCounter(counterId) {
            const counter = window.adminPanel.countersData?.find(c => c.id === counterId);
            if (!counter) {
                // Try to load counter data
                try {
                    const response = await window.adminPanel.makeRequest(`/admin/counters`);
                    const data = await response.json();
                    const counter = data.counters.find(c => c.id === counterId);
                    if (!counter) {
                        alert('Counter not found');
                        return;
                    }
                    populateCounterForm(counter);
                } catch (error) {
                    alert('Failed to load counter data');
                    return;
                }
            } else {
                populateCounterForm(counter);
            }
        }

        function populateCounterForm(counter) {
            // Populate form with counter data
            document.getElementById('counterId').value = counter.id;
            document.getElementById('counterNumber').value = counter.counter_number;
            document.getElementById('counterName').value = counter.name;
            document.getElementById('counterLocation').value = counter.location || '';
            document.getElementById('counterActive').checked = counter.is_active;
            document.getElementById('counterAutoAssign').checked = counter.auto_assign || false;
            
            // Set service checkboxes
            const serviceIds = (counter.services || []).map(s => s.service_id);
            document.querySelectorAll('input[name="counterServices"]').forEach(checkbox => {
                checkbox.checked = serviceIds.includes(parseInt(checkbox.value));
            });
            
            // Update modal title
            document.getElementById('counterModalTitle').textContent = 'Edit Counter';
            document.getElementById('counterSaveButtonText').textContent = 'Update Counter';
            
            // Show modal
            document.getElementById('addCounterModal').classList.add('show');
        }

        async function saveCounter(event) {
            event.preventDefault();
            
            const formData = new FormData(event.target);
            const counterId = formData.get('counterId');
            const isEdit = counterId && counterId !== '';
            
            // Get selected services
            const selectedServices = [];
            document.querySelectorAll('input[name="counterServices"]:checked').forEach(checkbox => {
                selectedServices.push(parseInt(checkbox.value));
            });
            
            const counterData = {
                counter_number: parseInt(formData.get('counterNumber')),
                name: formData.get('counterName'),
                location: formData.get('counterLocation') || null,
                is_active: formData.get('counterActive') ? true : false,
                auto_assign: formData.get('counterAutoAssign') ? true : false,
                services: selectedServices
            };
            
            try {
                const url = isEdit 
                    ? `/admin/counters/${counterId}` 
                    : '/admin/counters';
                const method = isEdit ? 'PUT' : 'POST';
                
                const response = await window.adminPanel.makeRequest(url, {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(counterData)
                });
                
                if (response.ok) {
                    closeCounterModal();
                    await refreshCounters();
                    window.adminPanel.showSuccess(
                        isEdit ? 'Counter updated successfully' : 'Counter created successfully'
                    );
                } else {
                    const error = await response.json();
                    showCounterValidationError(error.error || 'Failed to save counter');
                }
            } catch (error) {
                console.error('Error saving counter:', error);
                showCounterValidationError('Failed to save counter. Please try again.');
            }
        }

        function showCounterValidationError(message) {
            const validationDiv = document.getElementById('counterValidationMessages');
            validationDiv.innerHTML = `<div class="error-message">${message}</div>`;
            validationDiv.classList.add('show');
        }

        function closeCounterModal() {
            document.getElementById('addCounterModal').classList.remove('show');
            document.getElementById('counterForm').reset();
            const validationDiv = document.getElementById('counterValidationMessages');
            if (validationDiv) {
                validationDiv.innerHTML = '';
                validationDiv.classList.remove('show');
            }
        }

        async function toggleCounterStatus(counterId, currentStatus) {
            const newStatus = !currentStatus;
            const action = newStatus ? 'activate' : 'deactivate';
            
            if (!confirm(`Are you sure you want to ${action} this counter?`)) {
                return;
            }
            
            try {
                const response = await window.adminPanel.makeRequest(`/admin/counters/${counterId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ is_active: newStatus })
                });
                
                if (response.ok) {
                    await refreshCounters();
                    window.adminPanel.showSuccess(`Counter ${action}d successfully`);
                } else {
                    const error = await response.json();
                    alert(error.error || `Failed to ${action} counter`);
                }
            } catch (error) {
                console.error(`Error ${action}ing counter:`, error);
                alert(`Failed to ${action} counter. Please try again.`);
            }
        }

        let currentCounterIdToDelete = null;

        function deleteCounter(counterId) {
            currentCounterIdToDelete = counterId;
            const counter = window.adminPanel.countersData?.find(c => c.id === counterId);
            if (counter) {
                document.getElementById('deleteCounterName').textContent = counter.name;
            }
            document.getElementById('deleteCounterModal').classList.add('show');
        }

        function closeDeleteCounterModal() {
            document.getElementById('deleteCounterModal').classList.remove('show');
            currentCounterIdToDelete = null;
        }

        async function confirmDeleteCounter() {
            if (!currentCounterIdToDelete) return;
            
            try {
                const response = await window.adminPanel.makeRequest(`/admin/counters/${currentCounterIdToDelete}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    closeDeleteCounterModal();
                    await refreshCounters();
                    window.adminPanel.showSuccess('Counter deleted successfully');
                } else {
                    const error = await response.json();
                    alert(error.error || 'Failed to delete counter');
                }
            } catch (error) {
                console.error('Error deleting counter:', error);
                alert('Failed to delete counter. Please try again.');
            }
        }

        // Store counters data for reference
        window.adminPanel.countersData = [];
        
        // Override updateCountersTable to store data
        const originalUpdateCountersTable = window.adminPanel.updateCountersTable;
        window.adminPanel.updateCountersTable = function(counters) {
            window.adminPanel.countersData = counters;
            originalUpdateCountersTable.call(this, counters);
        };

        // Global functions for settings management
        async function saveAllSettings() {
            if (!window.adminPanel) return;

            const settings = window.adminPanel.collectSettingsFromForm();
            console.log('[Admin] Saving settings payload:', settings);
            
            // Validate settings
            const errors = window.adminPanel.validateSettings(settings);
            if (errors.length > 0) {
                alert('Please fix the following errors:\n\n' + errors.join('\n'));
                return;
            }

            // Disable save button during save
            const saveButton = document.querySelector('button[onclick="saveAllSettings()"]');
            const originalText = saveButton ? saveButton.textContent : '';
            if (saveButton) {
                saveButton.disabled = true;
                saveButton.textContent = 'Saving...';
            }

            try {
                const success = await window.adminPanel.saveSettingsData(settings);
                if (success) {
                    window.adminPanel.resetSaveButton();
                }
            } finally {
                // Re-enable save button
                if (saveButton) {
                    saveButton.disabled = false;
                    if (saveButton.textContent === 'Saving...') {
                        saveButton.textContent = originalText;
                    }
                }
            }
        }

        async function resetToDefaults() {
            if (confirm('Are you sure you want to reset all settings to their default values? This action cannot be undone.')) {
                await window.adminPanel.resetSettingsToDefaults();
            }
        }

        async function refreshSettingsLog() {
            if (window.adminPanel && window.adminPanel.currentSection === 'settings') {
                const changeLog = await window.adminPanel.loadSettingsChangeLog();
                window.adminPanel.updateSettingsLog(changeLog);
                
                // Visual feedback
                const btn = event.target;
                btn.style.transform = 'rotate(360deg)';
                setTimeout(() => {
                    btn.style.transform = 'rotate(0deg)';
                }, 500);
            }
        }

        // Add CSS for modified save button
        document.addEventListener('DOMContentLoaded', function() {
            const style = document.createElement('style');
            style.textContent = `
                .action-btn.modified {
                    background: #F59E0B !important;
                    animation: pulse 2s infinite;
                }
                
                @keyframes pulse {
                    0%, 100% { opacity: 1; }
                    50% { opacity: 0.7; }
                }
            `;
            document.head.appendChild(style);
        });

        // Update escape key handler for all modals
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                // Close all modal types
                closeServiceModal();
                closeDeleteModal();
                closeAgentModal();
                closeDeleteAgentModal();
                
                // Counter modals (placeholder functions for now)
                if (typeof closeCounterModal === 'function') closeCounterModal();
                if (typeof closeDeleteCounterModal === 'function') closeDeleteCounterModal();
            }
        });

        // Global functions for reports management
        async function generateReport() {
            if (!window.adminPanel) return;

            const dateFrom = document.getElementById('reportDateFrom').value;
            const dateTo = document.getElementById('reportDateTo').value;

            if (!dateFrom || !dateTo) {
                alert('Please select both start and end dates for the report.');
                return;
            }

            if (new Date(dateFrom) > new Date(dateTo)) {
                alert('Start date cannot be after end date.');
                return;
            }

            // Disable button during generation
            const generateBtn = event.target;
            const originalText = generateBtn.textContent;
            generateBtn.disabled = true;
            generateBtn.textContent = 'Generating...';

            try {
                // Reload reports data for the selected date range
                await window.adminPanel.loadReportsData();
                window.adminPanel.showSuccess('Report generated successfully for the selected date range!');
            } finally {
                // Re-enable button
                generateBtn.disabled = false;
                generateBtn.textContent = originalText;
            }
        }

        async function exportReport() {
            if (!window.adminPanel) return;

            const dateFrom = document.getElementById('reportDateFrom').value;
            const dateTo = document.getElementById('reportDateTo').value;

            if (!dateFrom || !dateTo) {
                alert('Please select both start and end dates for the report.');
                return;
            }

            await window.adminPanel.generateCustomReport(dateFrom, dateTo, 'pdf', 'full');
        }

        async function updatePerformanceChart() {
            if (!window.adminPanel) return;

            const period = document.getElementById('chartPeriod').value;
            console.log(`Updating performance chart for ${period} days`);
            
            // In real implementation, this would fetch data for the selected period
            window.adminPanel.createPerformanceChart();
        }

        async function setAgentPeriod(period) {
            // Update active button
            document.querySelectorAll('.period-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            // Load agent performance data for the selected period
            console.log(`Loading agent performance data for period: ${period}`);
            
            if (window.adminPanel) {
                const performanceData = await window.adminPanel.loadAgentPerformanceData();
                window.adminPanel.updateAgentPerformanceTable(performanceData);
            }
        }

        // Quick export functions
        async function exportDailyReport() {
            if (window.adminPanel) {
                await window.adminPanel.exportQuickReport('daily');
            }
        }

        async function exportWeeklyReport() {
            if (window.adminPanel) {
                await window.adminPanel.exportQuickReport('weekly');
            }
        }

        async function exportMonthlyReport() {
            if (window.adminPanel) {
                await window.adminPanel.exportQuickReport('monthly');
            }
        }

        async function exportAgentReport() {
            if (window.adminPanel) {
                await window.adminPanel.exportQuickReport('agent');
            }
        }

        async function customExport() {
            if (!window.adminPanel) return;

            const format = document.getElementById('exportFormat').value;
            const content = document.getElementById('exportContent').value;
            const dateFrom = document.getElementById('reportDateFrom').value;
            const dateTo = document.getElementById('reportDateTo').value;

            if (!dateFrom || !dateTo) {
                alert('Please select date range first.');
                return;
            }

            // Disable button during export
            const exportBtn = event.target;
            const originalText = exportBtn.textContent;
            exportBtn.disabled = true;
            exportBtn.textContent = 'Exporting...';

            try {
                await window.adminPanel.generateCustomReport(dateFrom, dateTo, format, content);
            } finally {
                // Re-enable button
                exportBtn.disabled = false;
                exportBtn.textContent = originalText;
            }
        }

        // Global functions for maintenance management
        async function performBackup() {
            if (!window.adminPanel) return;

            if (confirm('Are you sure you want to create a full system backup? This may take a few minutes.')) {
                const result = await window.adminPanel.performMaintenanceOperation('backup');
                if (result) {
                    // Refresh backup data to show new backup
                    const backupData = await window.adminPanel.loadBackupData();
                    window.adminPanel.updateBackupData(backupData);
                }
            }
        }

        async function optimizeDatabase() {
            if (!window.adminPanel) return;

            if (confirm('Are you sure you want to optimize the database? This may temporarily affect performance.')) {
                await window.adminPanel.performMaintenanceOperation('optimize_database');
            }
        }

        async function downloadLogs() {
            if (!window.adminPanel) return;
            await window.adminPanel.exportSystemLogs();
        }

        async function restartSystem() {
            if (!window.adminPanel) return;

            const confirmed = confirm(
                'Are you sure you want to restart the system?\n\n' +
                'This will:\n' +
                ' Disconnect all active users\n' +
                ' Temporarily interrupt service\n' +
                ' Take 30-60 seconds to complete\n\n' +
                'Only proceed if necessary.'
            );

            if (confirmed) {
                await window.adminPanel.performMaintenanceOperation('restart_system');
            }
        }

        async function cleanupOldData() {
            if (!window.adminPanel) return;

            if (confirm('Are you sure you want to cleanup old data? This will permanently remove completed tickets older than the retention period.')) {
                await window.adminPanel.performMaintenanceOperation('cleanup_old_data');
            }
        }

        async function rebuildIndexes() {
            if (!window.adminPanel) return;

            if (confirm('Are you sure you want to rebuild database indexes? This may take several minutes.')) {
                await window.adminPanel.performMaintenanceOperation('rebuild_indexes');
            }
        }

        async function analyzePerformance() {
            if (!window.adminPanel) return;
            await window.adminPanel.performMaintenanceOperation('analyze_performance');
        }

        async function runPerformanceTest() {
            if (!window.adminPanel) return;
            await window.adminPanel.performMaintenanceOperation('performance_test');
        }

        async function generatePerformanceReport() {
            if (!window.adminPanel) return;
            await window.adminPanel.performMaintenanceOperation('generate_performance_report');
        }

        async function optimizePerformance() {
            if (!window.adminPanel) return;

            if (confirm('Are you sure you want to run performance optimization? This may temporarily affect system responsiveness.')) {
                await window.adminPanel.performMaintenanceOperation('optimize_performance');
            }
        }

        async function runDiagnostics() {
            if (!window.adminPanel) return;

            // Disable button during diagnostics
            const diagnosticsBtn = event.target;
            const originalText = diagnosticsBtn.textContent;
            diagnosticsBtn.disabled = true;
            diagnosticsBtn.textContent = 'Running Diagnostics...';

            try {
                await window.adminPanel.runSystemDiagnostics();
            } finally {
                // Re-enable button
                diagnosticsBtn.disabled = false;
                diagnosticsBtn.textContent = originalText;
            }
        }

        async function filterLogs() {
            if (!window.adminPanel) return;

            const level = document.getElementById('logLevel').value;
            const period = document.getElementById('logPeriod').value;

            // Apply filters
            window.adminPanel.filterLogsByLevel(level);
            window.adminPanel.filterLogsByPeriod(period);
        }

        async function refreshLogs() {
            if (!window.adminPanel) return;

            // Visual feedback
            const refreshBtn = event.target;
            const originalText = refreshBtn.textContent;
            refreshBtn.disabled = true;
            refreshBtn.textContent = ' Refreshing...';

            try {
                const logs = await window.adminPanel.loadSystemLogs();
                window.adminPanel.updateSystemLogs(logs);
                window.adminPanel.showSuccess('System logs refreshed successfully!');
            } finally {
                // Re-enable button
                refreshBtn.disabled = false;
                refreshBtn.textContent = originalText;
            }
        }

        async function downloadBackup(filename) {
            if (!window.adminPanel) return;

            try {
                const response = await window.adminPanel.apiCall(`/admin/system/backups/${filename}/download`);
                
                if (response.ok) {
                    const blob = await response.blob();
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = filename;
                    document.body.appendChild(a);
                    a.click();
                    window.URL.revokeObjectURL(url);
                    document.body.removeChild(a);
                    
                    window.adminPanel.showSuccess('Backup downloaded successfully!');
                } else {
                    throw new Error('Failed to download backup');
                }
            } catch (error) {
                console.error('Error downloading backup:', error);
                window.adminPanel.showError('Error downloading backup: ' + error.message);
            }
        }

        async function restoreBackup(filename) {
            if (!window.adminPanel) return;

            const confirmed = confirm(
                `Are you sure you want to restore from backup "${filename}"?\n\n` +
                'WARNING: This will:\n' +
                ' Replace ALL current data\n' +
                ' Cannot be undone\n' +
                ' Restart the system\n\n' +
                'Only proceed if you are absolutely sure.'
            );

            if (confirmed) {
                const doubleConfirmed = confirm(
                    'FINAL WARNING: This action is IRREVERSIBLE.\n\n' +
                    'Type "RESTORE" in the next dialog to confirm.'
                );

                if (doubleConfirmed) {
                    const userInput = prompt('Type "RESTORE" to confirm:');
                    if (userInput === 'RESTORE') {
                        await window.adminPanel.performMaintenanceOperation('restore_backup', { filename });
                    } else {
                        alert('Backup restore cancelled - incorrect confirmation.');
                    }
                }
            }
        }

        // Placeholder - will be implemented with Counters tab
        function closeCounterModal() {
            // Placeholder - will be implemented with Counters tab
            console.log('Counter modal close - placeholder');
        }

        function closeDeleteCounterModal() {
            // Placeholder - will be implemented with Counters tab
            console.log('Delete counter modal close - placeholder');
        }

        // Global functions for dashboard quick actions
        async function resetQueue() {
            if (confirm('Are you sure you want to reset all queues? This will clear all waiting tickets.')) {
                try {
                    const response = await window.adminPanel.apiCall('/admin/system/reset', {
                        method: 'POST',
                        body: JSON.stringify({ resetType: 'queues' })
                    });
                    
                    if (response.ok) {
                        alert('Queue reset successfully!');
                        window.adminPanel.refreshDashboardStats();
                        window.adminPanel.refreshQueueStatus();
                    } else {
                        alert('Error resetting queue. Please try again.');
                    }
                } catch (error) {
                    console.error('Reset queue error:', error);
                    alert('Error resetting queue. Please check your connection.');
                }
            }
        }

        async function addAgentFromDashboard() {
            // Quick navigation to agents section
            window.adminPanel.showSection('agents');
        }

        async function toggleFeature() {
            // Quick navigation to settings section
            window.adminPanel.showSection('settings');
        }

        async function systemHealth() {
            try {
                const health = await window.adminPanel.loadSystemHealth();
                const healthStatus = Object.entries(health).map(([key, value]) => 
                    `${key}: ${value}`
                ).join('\n');
                
                alert(`System Health Status:\n\n${healthStatus}`);
            } catch (error) {
                console.error('Health check error:', error);
                alert('Error checking system health.');
            }
        }

        async function refreshQueues() {
            if (window.adminPanel) {
                await window.adminPanel.refreshQueueStatus();
                
                // Visual feedback
                const btn = event.target;
                btn.style.transform = 'rotate(360deg)';
                setTimeout(() => {
                    btn.style.transform = 'rotate(0deg)';
                }, 500);
            }
        }
    </script>
</body>
</html>
